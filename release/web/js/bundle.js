"use strict";(()=>{var t=Object.defineProperty,e=Object.getOwnPropertyDescriptor,a=(a,i,s,h)=>{for(var l,n=h>1?void 0:h?e(i,s):i,o=a.length-1;o>=0;o--)(l=a[o])&&(n=(h?l(i,s,n):l(n))||n);return h&&n&&t(i,s,n),n},i=(t,e,a)=>new Promise(((i,s)=>{var h=t=>{try{n(a.next(t))}catch(t){s(t)}},l=t=>{try{n(a.throw(t))}catch(t){s(t)}},n=t=>t.done?i(t.value):Promise.resolve(t.value).then(h,l);n((a=a.apply(t,e)).next())})),s=class{constructor(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.type)throw new Error;if(this.type=t.type,null!=t.target?this.target=t.target:this.target=void 0,void 0===t.count)throw new Error;if(this.count=t.count,void 0===t.description)throw new Error;if(this.description=t.description,void 0===t.reward_type)throw new Error;if(this.rewardType=t.reward_type,void 0===t.reward_str)throw new Error;this.rewardStr=t.reward_str}resolve(t){}},h=class{constructor(t){if(void 0===t.key)throw new Error;if(this.key=t.key,void 0===t.CHS)throw new Error;if(this.CHS=t.CHS,void 0===t.EN)throw new Error;if(this.EN=t.EN,void 0===t.CHT)throw new Error;if(this.CHT=t.CHT,void 0===t.JP)throw new Error;if(this.JP=t.JP,void 0===t.KR)throw new Error;if(this.KR=t.KR,void 0===t.TH)throw new Error;if(this.TH=t.TH,void 0===t.VN)throw new Error;this.VN=t.VN}resolve(t){}},l=class{constructor(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.level_min)throw new Error;if(this.levelMin=t.level_min,void 0===t.level_max)throw new Error;if(this.levelMax=t.level_max,void 0===t.health_rate)throw new Error;if(this.healthRate=t.health_rate,void 0===t.defence_rate)throw new Error;if(this.defenceRate=t.defence_rate,void 0===t.attack_rate)throw new Error;if(this.attackRate=t.attack_rate,void 0===t.monsters)throw new Error;this.monsters=new n(t.monsters)}resolve(t){var e;null==(e=this.monsters)||e.resolve(t)}},n=class{constructor(t){null!=t.h1?this.h1=t.h1:this.h1=void 0,null!=t.h2?this.h2=t.h2:this.h2=void 0,null!=t.h13?this.h13=t.h13:this.h13=void 0,null!=t.h14?this.h14=t.h14:this.h14=void 0,null!=t.h36?this.h36=t.h36:this.h36=void 0,null!=t.h137?this.h137=t.h137:this.h137=void 0,null!=t.h3?this.h3=t.h3:this.h3=void 0,null!=t.h15?this.h15=t.h15:this.h15=void 0,null!=t.h28?this.h28=t.h28:this.h28=void 0,null!=t.h37?this.h37=t.h37:this.h37=void 0,null!=t.h45?this.h45=t.h45:this.h45=void 0,null!=t.h55?this.h55=t.h55:this.h55=void 0,null!=t.h72?this.h72=t.h72:this.h72=void 0,null!=t.h82?this.h82=t.h82:this.h82=void 0,null!=t.h90?this.h90=t.h90:this.h90=void 0,null!=t.h96?this.h96=t.h96:this.h96=void 0,null!=t.h104?this.h104=t.h104:this.h104=void 0,null!=t.h108?this.h108=t.h108:this.h108=void 0,null!=t.h121?this.h121=t.h121:this.h121=void 0,null!=t.h129?this.h129=t.h129:this.h129=void 0,null!=t.h138?this.h138=t.h138:this.h138=void 0,null!=t.h4?this.h4=t.h4:this.h4=void 0,null!=t.h16?this.h16=t.h16:this.h16=void 0,null!=t.h17?this.h17=t.h17:this.h17=void 0,null!=t.h29?this.h29=t.h29:this.h29=void 0,null!=t.h38?this.h38=t.h38:this.h38=void 0,null!=t.h46?this.h46=t.h46:this.h46=void 0,null!=t.h53?this.h53=t.h53:this.h53=void 0,null!=t.h56?this.h56=t.h56:this.h56=void 0,null!=t.h62?this.h62=t.h62:this.h62=void 0,null!=t.h73?this.h73=t.h73:this.h73=void 0,null!=t.h83?this.h83=t.h83:this.h83=void 0,null!=t.h91?this.h91=t.h91:this.h91=void 0,null!=t.h97?this.h97=t.h97:this.h97=void 0,null!=t.h105?this.h105=t.h105:this.h105=void 0,null!=t.h109?this.h109=t.h109:this.h109=void 0,null!=t.h116?this.h116=t.h116:this.h116=void 0,null!=t.h122?this.h122=t.h122:this.h122=void 0,null!=t.h126?this.h126=t.h126:this.h126=void 0,null!=t.h130?this.h130=t.h130:this.h130=void 0,null!=t.h135?this.h135=t.h135:this.h135=void 0,null!=t.h139?this.h139=t.h139:this.h139=void 0,null!=t.h5?this.h5=t.h5:this.h5=void 0,null!=t.h18?this.h18=t.h18:this.h18=void 0,null!=t.h30?this.h30=t.h30:this.h30=void 0,null!=t.h39?this.h39=t.h39:this.h39=void 0,null!=t.h47?this.h47=t.h47:this.h47=void 0,null!=t.h57?this.h57=t.h57:this.h57=void 0,null!=t.h63?this.h63=t.h63:this.h63=void 0,null!=t.h74?this.h74=t.h74:this.h74=void 0,null!=t.h84?this.h84=t.h84:this.h84=void 0,null!=t.h88?this.h88=t.h88:this.h88=void 0,null!=t.h92?this.h92=t.h92:this.h92=void 0,null!=t.h98?this.h98=t.h98:this.h98=void 0,null!=t.h106?this.h106=t.h106:this.h106=void 0,null!=t.h110?this.h110=t.h110:this.h110=void 0,null!=t.h117?this.h117=t.h117:this.h117=void 0,null!=t.h123?this.h123=t.h123:this.h123=void 0,null!=t.h127?this.h127=t.h127:this.h127=void 0,null!=t.h131?this.h131=t.h131:this.h131=void 0,null!=t.h140?this.h140=t.h140:this.h140=void 0,null!=t.h6?this.h6=t.h6:this.h6=void 0,null!=t.h19?this.h19=t.h19:this.h19=void 0,null!=t.h20?this.h20=t.h20:this.h20=void 0,null!=t.h31?this.h31=t.h31:this.h31=void 0,null!=t.h40?this.h40=t.h40:this.h40=void 0,null!=t.h48?this.h48=t.h48:this.h48=void 0,null!=t.h54?this.h54=t.h54:this.h54=void 0,null!=t.h58?this.h58=t.h58:this.h58=void 0,null!=t.h64?this.h64=t.h64:this.h64=void 0,null!=t.h75?this.h75=t.h75:this.h75=void 0,null!=t.h85?this.h85=t.h85:this.h85=void 0,null!=t.h93?this.h93=t.h93:this.h93=void 0,null!=t.h99?this.h99=t.h99:this.h99=void 0,null!=t.h107?this.h107=t.h107:this.h107=void 0,null!=t.h111?this.h111=t.h111:this.h111=void 0,null!=t.h118?this.h118=t.h118:this.h118=void 0,null!=t.h124?this.h124=t.h124:this.h124=void 0,null!=t.h128?this.h128=t.h128:this.h128=void 0,null!=t.h132?this.h132=t.h132:this.h132=void 0,null!=t.h7?this.h7=t.h7:this.h7=void 0,null!=t.h21?this.h21=t.h21:this.h21=void 0,null!=t.h22?this.h22=t.h22:this.h22=void 0,null!=t.h23?this.h23=t.h23:this.h23=void 0,null!=t.h32?this.h32=t.h32:this.h32=void 0,null!=t.h41?this.h41=t.h41:this.h41=void 0,null!=t.h49?this.h49=t.h49:this.h49=void 0,null!=t.h59?this.h59=t.h59:this.h59=void 0,null!=t.h65?this.h65=t.h65:this.h65=void 0,null!=t.h76?this.h76=t.h76:this.h76=void 0,null!=t.h86?this.h86=t.h86:this.h86=void 0,null!=t.h89?this.h89=t.h89:this.h89=void 0,null!=t.h94?this.h94=t.h94:this.h94=void 0,null!=t.h100?this.h100=t.h100:this.h100=void 0,null!=t.h112?this.h112=t.h112:this.h112=void 0,null!=t.h119?this.h119=t.h119:this.h119=void 0,null!=t.h125?this.h125=t.h125:this.h125=void 0,null!=t.h133?this.h133=t.h133:this.h133=void 0,null!=t.h136?this.h136=t.h136:this.h136=void 0,null!=t.h8?this.h8=t.h8:this.h8=void 0,null!=t.h9?this.h9=t.h9:this.h9=void 0,null!=t.h24?this.h24=t.h24:this.h24=void 0,null!=t.h25?this.h25=t.h25:this.h25=void 0,null!=t.h33?this.h33=t.h33:this.h33=void 0,null!=t.h42?this.h42=t.h42:this.h42=void 0,null!=t.h50?this.h50=t.h50:this.h50=void 0,null!=t.h60?this.h60=t.h60:this.h60=void 0,null!=t.h66?this.h66=t.h66:this.h66=void 0,null!=t.h68?this.h68=t.h68:this.h68=void 0,null!=t.h77?this.h77=t.h77:this.h77=void 0,null!=t.h87?this.h87=t.h87:this.h87=void 0,null!=t.h95?this.h95=t.h95:this.h95=void 0,null!=t.h101?this.h101=t.h101:this.h101=void 0,null!=t.h102?this.h102=t.h102:this.h102=void 0,null!=t.h113?this.h113=t.h113:this.h113=void 0,null!=t.h120?this.h120=t.h120:this.h120=void 0,null!=t.h134?this.h134=t.h134:this.h134=void 0,null!=t.h10?this.h10=t.h10:this.h10=void 0,null!=t.h26?this.h26=t.h26:this.h26=void 0,null!=t.h34?this.h34=t.h34:this.h34=void 0,null!=t.h43?this.h43=t.h43:this.h43=void 0,null!=t.h51?this.h51=t.h51:this.h51=void 0,null!=t.h61?this.h61=t.h61:this.h61=void 0,null!=t.h67?this.h67=t.h67:this.h67=void 0,null!=t.h69?this.h69=t.h69:this.h69=void 0,null!=t.h70?this.h70=t.h70:this.h70=void 0,null!=t.h71?this.h71=t.h71:this.h71=void 0,null!=t.h78?this.h78=t.h78:this.h78=void 0,null!=t.h79?this.h79=t.h79:this.h79=void 0,null!=t.h80?this.h80=t.h80:this.h80=void 0,null!=t.h81?this.h81=t.h81:this.h81=void 0,null!=t.h103?this.h103=t.h103:this.h103=void 0,null!=t.h114?this.h114=t.h114:this.h114=void 0,null!=t.h11?this.h11=t.h11:this.h11=void 0,null!=t.h12?this.h12=t.h12:this.h12=void 0,null!=t.h27?this.h27=t.h27:this.h27=void 0,null!=t.h35?this.h35=t.h35:this.h35=void 0,null!=t.h44?this.h44=t.h44:this.h44=void 0,null!=t.h52?this.h52=t.h52:this.h52=void 0,null!=t.h115?this.h115=t.h115:this.h115=void 0}resolve(t){}},o=class{constructor(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.need)throw new Error;if(this.need=t.need,void 0===t.health)throw new Error;if(this.health=t.health,void 0===t.attack)throw new Error;if(this.attack=t.attack,void 0===t.defence)throw new Error;this.defence=t.defence}resolve(t){}},r=class{constructor(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.name)throw new Error;if(this.name=t.name,void 0===t.rare)throw new Error;if(this.rare=t.rare,void 0===t.quality_type)throw new Error;if(this.qualityType=t.quality_type,void 0===t.quality)throw new Error;if(this.quality=t.quality,void 0===t.race)throw new Error;if(this.race=t.race,void 0===t.remain)throw new Error;if(this.remain=t.remain,void 0===t.exp_need)throw new Error;if(this.expNeed=t.exp_need,void 0===t.exp_dead)throw new Error;if(this.expDead=t.exp_dead,void 0===t.attack_rate)throw new Error;if(this.attackRate=t.attack_rate,void 0===t.defence_rate)throw new Error;if(this.defenceRate=t.defence_rate,void 0===t.health_rate)throw new Error;if(this.healthRate=t.health_rate,void 0===t.attack_add)throw new Error;if(this.attackAdd=t.attack_add,void 0===t.defence_add)throw new Error;if(this.defenceAdd=t.defence_add,void 0===t.health_add)throw new Error;if(this.healthAdd=t.health_add,void 0===t.relations)throw new Error;if(this.relations=new c(t.relations),void 0===t.skills)throw new Error;this.skills=[];for(let e of t.skills){let t;t=e,this.skills.push(t)}}resolve(t){var e;null==(e=this.relations)||e.resolve(t)}},d=class{constructor(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.need)throw new Error;if(this.need=t.need,void 0===t.exp)throw new Error;if(this.exp=t.exp,void 0===t.attack)throw new Error;if(this.attack=t.attack,void 0===t.defence)throw new Error;if(this.defence=t.defence,void 0===t.health)throw new Error;this.health=t.health}resolve(t){}},c=class{constructor(t){null!=t.chi?this.chi=t.chi:this.chi=void 0,null!=t.hui?this.hui=t.hui:this.hui=void 0,null!=t.lin?this.lin=t.lin:this.lin=void 0,null!=t.mao?this.mao=t.mao:this.mao=void 0,null!=t.jia?this.jia=t.jia:this.jia=void 0,null!=t.luo?this.luo=t.luo:this.luo=void 0,null!=t.yu?this.yu=t.yu:this.yu=void 0,null!=t.zhao?this.zhao=t.zhao:this.zhao=void 0,null!=t.ti?this.ti=t.ti:this.ti=void 0,null!=t.jiao?this.jiao=t.jiao:this.jiao=void 0,null!=t.zhi?this.zhi=t.zhi:this.zhi=void 0}resolve(t){}},u=class{constructor(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.name)throw new Error;if(this.name=t.name,void 0===t.effect_str)throw new Error;if(this.effectStr=t.effect_str,void 0===t.description)throw new Error;if(this.description=t.description,void 0===t.type)throw new Error;if(this.type=t.type,void 0===t.target)throw new Error;if(this.target=t.target,void 0===t.trigger)throw new Error;if(this.trigger=t.trigger,void 0===t.condition)throw new Error;for(var e of(this.condition=new Map,t.condition)){let t,a;t=e[0],a=e[1],this.condition.set(t,a)}if(null!=t.buff_round?this.buffRound=t.buff_round:this.buffRound=void 0,void 0===t.rate)throw new Error;if(this.rate=t.rate,void 0===t.values)throw new Error;for(var e of(this.values=new Map,t.values)){let t,a;t=e[0],a=e[1],this.values.set(t,a)}}resolve(t){}},g=class{constructor(t){for(var e of(this._dataMap=new Map,this._dataList=[],t)){let t;t=new s(e),this._dataList.push(t),this._dataMap.set(t.id,t)}}getDataMap(){return this._dataMap}getDataList(){return this._dataList}get(t){return this._dataMap.get(t)}resolve(t){for(let e of this._dataList)e.resolve(t)}},f=class{constructor(t){for(var e of(this._dataMap=new Map,this._dataList=[],t)){let t;t=new h(e),this._dataList.push(t),this._dataMap.set(t.key,t)}}getDataMap(){return this._dataMap}getDataList(){return this._dataList}get(t){return this._dataMap.get(t)}resolve(t){for(let e of this._dataList)e.resolve(t)}},p=class{constructor(t){for(var e of(this._dataMap=new Map,this._dataList=[],t)){let t;t=new l(e),this._dataList.push(t),this._dataMap.set(t.id,t)}}getDataMap(){return this._dataMap}getDataList(){return this._dataList}get(t){return this._dataMap.get(t)}resolve(t){for(let e of this._dataList)e.resolve(t)}},v=class{constructor(t){for(var e of(this._dataMap=new Map,this._dataList=[],t)){let t;t=new o(e),this._dataList.push(t),this._dataMap.set(t.id,t)}}getDataMap(){return this._dataMap}getDataList(){return this._dataList}get(t){return this._dataMap.get(t)}resolve(t){for(let e of this._dataList)e.resolve(t)}},m=class{constructor(t){for(var e of(this._dataMap=new Map,this._dataList=[],t)){let t;t=new r(e),this._dataList.push(t),this._dataMap.set(t.id,t)}}getDataMap(){return this._dataMap}getDataList(){return this._dataList}get(t){return this._dataMap.get(t)}resolve(t){for(let e of this._dataList)e.resolve(t)}},y=class{constructor(t){for(var e of(this._dataMap=new Map,this._dataList=[],t)){let t;t=new d(e),this._dataList.push(t),this._dataMap.set(t.id,t)}}getDataMap(){return this._dataMap}getDataList(){return this._dataList}get(t){return this._dataMap.get(t)}resolve(t){for(let e of this._dataList)e.resolve(t)}},w=class{constructor(t){for(var e of(this._dataMap=new Map,this._dataList=[],t)){let t;t=new u(e),this._dataList.push(t),this._dataMap.set(t.id,t)}}getDataMap(){return this._dataMap}getDataList(){return this._dataList}get(t){return this._dataMap.get(t)}resolve(t){for(let e of this._dataList)e.resolve(t)}},b=class{get Tbachieve(){return this._Tbachieve}get Tblang(){return this._Tblang}get Tbmap_level(){return this._Tbmap_level}get Tbrebirth(){return this._Tbrebirth}get Tbrole(){return this._Tbrole}get Tbrole_level(){return this._Tbrole_level}get Tbskill(){return this._Tbskill}constructor(t){this._Tbachieve=new g(t("tbachieve")),this._Tblang=new f(t("tblang")),this._Tbmap_level=new p(t("tbmap_level")),this._Tbrebirth=new v(t("tbrebirth")),this._Tbrole=new m(t("tbrole")),this._Tbrole_level=new y(t("tbrole_level")),this._Tbskill=new w(t("tbskill")),this._Tbachieve.resolve(this),this._Tblang.resolve(this),this._Tbmap_level.resolve(this),this._Tbrebirth.resolve(this),this._Tbrole.resolve(this),this._Tbrole_level.resolve(this),this._Tbskill.resolve(this)}},_=class t{static load_config(){return i(this,null,(function*(){const e=["resources/json/tbachieve.json","resources/json/tblang.json","resources/json/tbmap_level.json","resources/json/tbrebirth.json","resources/json/tbrole.json","resources/json/tbrole_level.json","resources/json/tbskill.json"];yield Laya.loader.load(e,Laya.Loader.JSON).then((e=>{let a=0;t.table=new b((()=>e[a++].data))})).catch((t=>{})),e.forEach((t=>{Laya.loader.clearRes(t)}))}))}static load_sound(){return i(this,null,(function*(){this.sounds.set("bgm","resources/sound/bgm.mp3"),this.sounds.set("ui_anniu","resources/sound/ui_anniu.mp3"),this.sounds.set("ui_anniu2","resources/sound/ui_anniu2.mp3"),this.sounds.set("att","resources/sound/att.mp3"),this.sounds.set("def","resources/sound/def.mp3"),this.sounds.set("die","resources/sound/die.mp3"),this.sounds.set("upgrade","resources/sound/upgrade.mp3"),this.sounds.set("win","resources/sound/win.mp3"),this.sounds.set("battle_bgm","resources/sound/battle_bgm.mp3"),yield Laya.loader.load(Array.from(this.sounds.values()))}))}static load_prefab(){return i(this,null,(function*(){this.prefabs.set("PopUp","resources/prefab/PopUp.lh"),yield Laya.loader.load(Array.from(this.prefabs.values()))}))}};_.sounds=new Map,_.prefabs=new Map;var k=_,S=1.2,x=1.2,L=2,T=1.05,C=10,M=.1,E=[100,150,200],B=[10,20,30,40,45,50,55,60,65],N={xinximoban:{shanghai:"#ff0200",huixue:"#5aff00",player:"#e1ffd5",enemy:"#ffe8e4",skill:"#fffe00"},pinzhi:{none:"#bfbfbf",ling:"#00b0f0",xian:"#ffff00",shen:"#ff0000"},name:{hui:"#bfbfbf",dian:"#bfbfbf",0:"#bfbfbf",1:"#ffffff",2:"#90ee90",3:"#06b400",4:"#8ea9db",5:"#00b0f0",6:"#7030a0",7:"#ffff00",8:"#ffc000",9:"#ff0000"}},R={zhandou:{kaishi:"----------开始战斗----------",jineng1:"<font color='{p}'>你使用了技能·<font color='{s}'>*</font>,&</font>",jineng2:"<font color='{e}'>^使用了技能·<font color='{s}'>*</font>,&</font>",shanbi1:"<font color='{p}'>你闪避了!</font>",shanbi2:"<font color='{e}'>*闪避了!</font>",gedang1:"<font color='{p}'>你格挡了!</font>",gedang2:"<font color='{e}'>*格挡了!</font>",huihe1:"<font color='{p}'>你对*发动了攻击,造成了<font color='{s}'>&</font>点伤害.</font>",huihe2:"<font color='{e}'>*对你发动了攻击,造成了<font color='{s}'>&</font>点伤害.</font>",huifu1:"<font color='{p}'>你恢复了<font color='{s}'>&</font>点生命.</font>",huifu2:"<font color='{e}'>*恢复了<font color='{s}'>&</font>点生命.</font>",siwang1:"你吞噬了*.",siwang2:"*吞噬了你.",jieshu:"----------战斗结束----------",taopao:"你逃出生天!"},jinhua:{chenggong:"<font color='^'>拟态成功</font>,拟态为*",shibai1:"<font color='^'>拟态失败</font>,肉身崩坏死亡！",shibai2:"<font color='^'>拟态失败</font>,损失等级10级。"},qianjin:"你遇到了{0},{1},{2}!",zhandouli:"当前战斗力为:<font color='#ff8c00'>*</font>",shenru:"你来到第*层.",shengji:"你的等级为:*.",zhuansheng:"<font color='^'>转生成功</font>,属性成长提升",cuilian:"<font color='^'>淬炼成功</font>,属性向拟态生物靠拢",tunshi:"你吞噬了*,解析成功获得技能·<font color='^'>&</font>",buzu:"<font color='#FF0000'>等级不足</font>"},$={chi:"齿",hui:"喙",lin:"鳞",mao:"毛",jia:"甲",luo:"蠃",yu:"羽",zhao:"爪",ti:"蹄",jiao:"角",zhi:"智"},A=["拟态失败有可能死亡，拟态需谨慎","转生3次后，史莱姆会获得专属技能“解析”","拟态时，属性匹配度越高、属性值越高成功率越高","自动战斗可不一定是什么好事","偷偷说一下，人族非常厉害","淬炼可以让属性变得更纯粹","拟态只会拟态成灵属性最高或无属性的生物","已解锁的图鉴会给史莱姆提供属性加成","等级超过99级后升级获得的属性会大幅下降","所有生物20%概率吞噬敌人获得新的技能","转生超过99次、199次后转生获得的属性会大幅下降"];String.prototype.toStr=function(){if(!this)return this;let t=k.table.Tblang.get(this);return t?t[D.key]:this};var D=class t{static init(){t.key=Laya.LocalStorage.getItem("language")||"CHS"}static setLanguage(e){t.key=e,Laya.LocalStorage.setItem("language",e)}},H=class t{constructor(t=200){this.maxLength=t,this.logs=[],this.maxLength=t}add(t){this.logs.length>=this.maxLength&&this.logs.shift(),this.logs.push(t),this.callback&&this.callback()}static log(e,a=!0){a&&(e=e.toStr()),this.instance||(this.instance=new t),this.instance.add(e)}static get(){return this.instance.logs}static clear(){this.instance.logs.length=0}};function j(t){return new Promise((e=>setTimeout(e,t)))}function z(t){return Math.floor(t)}function P(t){return`${Math.floor(1e3*t)/10}%`}function O(t){let e,a;"CHS"===D.key&&(e=["万","亿","兆"]),"CHT"===D.key&&(e=["萬","億","兆"]),"JP"===D.key&&(e=["万","億","兆"]),"KR"===D.key&&(e=["만","억","조"]),a=e?[{value:1e12,symbol:e[2]},{value:1e8,symbol:e[1]},{value:1e4,symbol:e[0]}]:[{value:1e12,symbol:"T"},{value:1e9,symbol:"B"},{value:1e6,symbol:"M"},{value:1e3,symbol:"K"}];for(const e of a)if(t>=e.value){return(t/e.value).toFixed(2).replace(/\.?0+$/,"")+e.symbol}return t.toString()}function q(t){return t.toString()}var{regClass:F,property:G}=Laya,I=class extends Laya.Script{onAwake(){this.bg||(this.bg=this.owner.addChild(new Laya.Sprite),this.bar=this.bg.addChild(new Laya.Sprite),this.bg.size(160,16),this.bg.pos(35,88),this.bar.size(158,14),this.bar.pos(1,1),this.bg.graphics.drawRect(0,0,1,1,"#313c3c","#ffffff").percent=!0,this.drawRect=this.bar.graphics.drawRect(0,0,1,1,"#ff0000"),this.drawRect.percent=!0),this.originalWidth=this.bar.width,this.setValue(0,!1)}setValue(t,e=!0){const a=this.originalWidth*Math.min(Math.max(t,0),1);e?Laya.Tween.to(this.bar,{width:a},200):this.bar.width=a}setColor(t){this.drawRect&&(this.drawRect.fillColor=t)}};a([G({type:Laya.Sprite})],I.prototype,"bg",2),a([G({type:Laya.Sprite})],I.prototype,"bar",2),I=a([F("uO32Pu0TShWyXIQxB9XMyw")],I);var K=class t{static tip(e,a=!0){if(e){a&&(e=e.toStr());var i=50*this.tipsQueue.length;H.log(e,!1);var s=new Laya.Label;s.text=e,s.fontSize=36,s.color="#ffffff",s.pos(Laya.stage.width/2,Laya.stage.height/2+i),s.alpha=1,s.align="center",s.valign="middle",s.anchorX=.5,s.anchorY=.5,s.width=540,s.wordWrap=!0,s.html=!0,Laya.stage.addChild(s),Laya.Tween.to(s,{scaleX:1.5,scaleY:1.5},200,Laya.Ease.quadIn,Laya.Handler.create(s,(function(){Laya.Tween.to(s,{scaleX:1,scaleY:1},200,Laya.Ease.quadOut),Laya.Tween.to(s,{y:Laya.stage.height/2-100+i,alpha:0},1e3,Laya.Ease.linearNone,Laya.Handler.create(s,(function(){s.removeSelf(),t.tipsQueue.shift()})))}))),t.tipsQueue.push(s)}}static show(t,e,a,i=!0){let s=Laya.loader.getRes(k.prefabs.get("PopUp")).create();return Laya.stage.addChild(s),s.Label.text=t,s.open(),i?(s.ok.visible=!0,s.no.x=420):(s.ok.visible=!1,s.no.x=285,s.no.title.text="确认".toStr(),H.log(t,!1)),s.ok.onClick=()=>{s.close((()=>{s.destroy()})),e&&e()},s.no.onClick=()=>{s.close((()=>{s.destroy()})),a&&a()},s}};K.tipsQueue=[];var V=K,{regClass:X}=Laya,U=class extends Laya.Script{onAwake(){this.animator=this.owner.getComponent(Laya.Animator2D),this.original_x=this.owner.x,this.original_y=this.owner.y,this.hpBar=this.owner.getComponent(I),this.owner.onClick=()=>{Nt.instance.Enemy.getComponent(U).show(this.data.id,this.level),Nt.instance.show_battle(this.data.id,this.level,!1)}}init(t,e,a){let i=k.table.Tbrole.get(e);this.data=i,this.level=a,this.owner.title.text=Nt.getRoleName(i),this.owner.image.getChildByName("Level").text=`Lv.${a}`;let s=k.table.Tbrole_level.get(a),h=z(s.attack*i.attackRate*t.attackRate),l=z(s.defence*i.defenceRate*t.defenceRate),n=z(s.health*i.healthRate*t.healthRate),o=Nt.getPower(h,l,n);this.owner.image.getChildByName("Tip").text="战力:".toStr()+`${O(o)}`}show(t,e,a){let i=k.table.Tbrole.get(t);this.data=i,this.level=e,this.owner.title.text=Nt.getRoleName(i),this.owner.image.getChildByName("Level").text=`Lv.${e}`,a&&(this.owner.image.getChildByName("Tip").text="战力:".toStr()+`${O(a)}`)}show_skin(t){t?(this.owner.image.skin="resources/image/boss.png",this.owner.image.color="#9A1919"):(this.owner.image.skin="resources/image/enemy.png",this.owner.image.color="#666b6f")}play_anim(t){this.animator.play(t,0,0)}};U=a([X("GkQGXdX0S-eACaQKWc1P0w")],U);var Y=class{static getList(t){return"player"==t?this.playerBuff:this.enemyBuff}static getBuff(t,e){var a;return null!=(a=this.getList(t.camp).find((t=>t.data.id===e.id)))?a:null}static createBuff(t,e){let a;if(3===e.type)a=new J(e,t);else a=new Q(e,t);return this.getList(t.camp).push(a),a}static addBuff(t,e,a){if(void 0===a.buffRound)return;let i=this.getBuff(e,a);if(i&&i.reapply())return;if(i=this.createBuff(e,a),null==i)return;if(i.apply(),0===a.buffRound)return void this.tempBuff.push(i);if(-1===a.buffRound)return void this.permanentBuff.push(i);let s=t.camp+a.name;this.buffs.has(s)||this.buffs.set(s,i)}static removeBuffByOwner(t,e){let a=this.getList(t.camp);for(let t=a.length-1;t>=0;t--)if(a[t]===e){a.splice(t,1);break}}static is(t,e){var a,i;return null!=(i=null==(a=this.getList(t.camp))?void 0:a.some((t=>t.type===e)))&&i}static clearTemp(){0!==this.tempBuff.length&&(this.tempBuff.forEach((t=>t.remove())),this.tempBuff.length=0)}static clearByRevive(t){this.clearTemp();const e=[];for(const[a,i]of this.buffs)i.owner===t&&(i.remove(),e.push(a));e.forEach((t=>this.buffs.delete(t)))}static clear(){this.playerBuff.length=0,this.enemyBuff.length=0,this.tempBuff.length=0,this.permanentBuff.length=0,this.buffs.clear()}static updateBuffs(t){if(this.buffs.has(t)){const e=this.buffs.get(t);e.updateBuffs()&&(this.buffs.delete(t),e.remove())}}};Y.playerBuff=[],Y.enemyBuff=[],Y.tempBuff=[],Y.permanentBuff=[],Y.buffs=new Map;var Q=class{constructor(t,e){this.data=t,this.owner=e,this.name=t.name,this.duration=t.buffRound,this.type=t.type}apply(){}remove(){Y.removeBuffByOwner(this.owner,this)}reapply(){return this.duration=this.data.buffRound,!0}updateBuffs(){return this.duration--,this.duration<=0&&(this.remove(),!0)}},J=class extends Q{constructor(){super(...arguments),this.attack=0,this.defence=0}apply(){if(this.data.values.has("1")){let t=Number(this.data.values.get("1"));this.attack=z(t*this.owner.attack.value),this.owner.attack.add(this.attack)}if(this.data.values.has("2")){let t=Number(this.data.values.get("2"));this.defence=z(t*this.owner.defence.value),this.owner.defence.add(this.defence)}}remove(){0!=this.attack&&this.owner.attack.add(-this.attack),0!=this.defence&&this.owner.defence.add(-this.defence),super.remove()}reapply(){if(this.data.buffRound>0)return!1;if(super.reapply(),this.data.values.has("1")){let t=this.attack,e=Number(this.data.values.get("1"));this.attack=z(e*this.owner.attack.value)+t,this.owner.attack.add(-t),this.owner.attack.add(this.attack)}if(this.data.values.has("2")){let t=this.defence,e=Number(this.data.values.get("2"));this.defence=z(e*this.owner.defence.value)+t,this.owner.defence.add(-t),this.owner.defence.add(this.defence)}return!0}},W=class t{static getDamageLabel(){let t=this.damageLabelPool.pop();return t||(t=new Laya.Label,t.bold=!0,t.fontSize=32,t.anchorX=.5,t.width=300,t.align="center"),t.visible=!0,t.alpha=1,t.scale(1,1),Nt.instance.Damages.addChild(t),t}static recycleDamageLabel(t){t.removeSelf(),t.visible=!1,this.damageLabelPool.push(t)}static show(e){const a=e.y;e.alpha=0,Laya.Tween.to(e,{alpha:1},200),Laya.Tween.to(e,{y:a-50,scale:1.5},500,null,Laya.Handler.create(this,(()=>{Laya.Tween.to(e,{y:a-100,scale:.5,alpha:0},500,null,Laya.Handler.create(this,(()=>{t.recycleDamageLabel(e)})))})))}static showDamage(t,e){const a=this.getDamageLabel();a.text=`-${O(-t)}`,a.color="#ee123d",a.pos(e.original_x,e.original_y-80),this.show(a)}static showHeal(t,e){const a=this.getDamageLabel();a.text=`+${O(t)}`,a.color="#12ee64",a.pos(e.original_x,e.original_y);const i=a.x;a.x=i+(100*Math.random()-50),this.show(a)}static showDodge(e){const a=this.getDamageLabel();a.text="闪避".toStr(),a.color="#12eee0",a.pos(e.original_x,e.original_y);const i=a.x,s=a.y;a.x=i+(100*Math.random()-50),a.y=s,a.alpha=0,Laya.Tween.to(a,{alpha:1},200,null,null,0),Laya.Tween.to(a,{alpha:.8},100,null,null,200),Laya.Tween.to(a,{alpha:1},100,null,null,300),Laya.Tween.to(a,{y:s-30,scale:1.2},150,null,Laya.Handler.create(this,(()=>{Laya.Tween.to(a,{y:s-15,scale:1},150,null,Laya.Handler.create(this,(()=>{Laya.Tween.to(a,{y:s-10,scale:.8,alpha:0},300,null,Laya.Handler.create(this,(()=>{t.recycleDamageLabel(a)})))})))})),400)}static showBlock(e){const a=this.getDamageLabel();a.text="格挡".toStr(),a.color="#eee712",a.pos(e.original_x,e.original_y);const i=a.x,s=a.y;a.x=i+(100*Math.random()-50),a.y=s,a.alpha=0,Laya.Tween.to(a,{alpha:1},300),Laya.Tween.to(a,{y:s-80,scale:1.2},500,null,Laya.Handler.create(this,(()=>{Laya.Tween.to(a,{y:s-100,scale:1,alpha:0},500,null,Laya.Handler.create(this,(()=>{t.recycleDamageLabel(a)})))})))}};W.damageLabelPool=[];var Z=W,tt=class{constructor(){this._flag=0,this._items=[]}add(t,e,a){const i=this._items,s=i.findIndex(((a,s)=>a===t&&i[s+1]===e));-1!==s?(i[s+2]=a,i[s+3]=1):i.push(t,e,a,1)}once(t,e,a){const i=this._items,s=i.findIndex(((a,s)=>a===t&&i[s+1]===e));-1!==s?(i[s+2]=a,i[s+3]=2):i.push(t,e,a,2)}remove(t,e){const a=this._items,i=a.findIndex(((i,s)=>i===t&&a[s+1]===e));-1!==i&&(0!==this._flag?(a[i+3]=0,this._flag=2):a.splice(i,4))}clear(){if(0!==this._flag){for(let t=3;t<this._items.length;t+=4)this._items[t]=0;this._flag=2}else this._items.length=0}clearForTarget(t){if(!t)return;const e=this._items;if(0!==this._flag){for(let a=1;a<e.length;a+=4)e[a]===t&&(e[a+3]=0);this._flag=2}else for(let a=e.length-4;a>=0;a-=4)e[a+1]===t&&e.splice(a,4)}get count(){return this._items.length/4}invokeAsync(...t){return i(this,null,(function*(){if(0!==this._flag)return;this._flag=1;const e=this._items,a=[];for(let i=0;i<e.length;i+=4){if(0===e[i+3])continue;const s=e[i],h=e[i+1],l=e[i+2];try{const e=l?s.call(h,...l,...t):s.call(h,...t);e instanceof Promise&&a.push(e)}catch(t){}2===e[i+3]&&(e[i+3]=0,this._flag=2)}if(a.length>0&&(yield Promise.all(a)),2===this._flag)for(let t=0;t<e.length;)0===e[t+3]?e.splice(t,4):t+=4;this._flag=0}))}},et=class{constructor(){this._events={}}hasListener(t){const e=this._events[t];return!!e&&e.count>0}on(t,e,a,i){this._events[t]||(this._events[t]=new tt),this._events[t].add(a,e,i)}once(t,e,a,i){this._events[t]||(this._events[t]=new tt),this._events[t].once(a,e,i)}off(t,e,a){const i=this._events[t];i&&i.remove(a,e)}offAll(t){t?delete this._events[t]:this._events={}}dispatchAsync(t,...e){return i(this,null,(function*(){const a=this._events[t];a&&(yield a.invokeAsync(...e))}))}};var at=class{constructor(t){this.data=t}check(t){return Math.random()<=this.data.rate}},it=class extends at{check(t){return this.data.condition?!!(this.data.condition.has("hp")&&t.health.per<=this.data.condition.get("hp"))&&super.check(t):super.check(t)}},st=class{static getList(t){return"player"==t?this.playerSkills:this.enemySkills}static createSkill(t,e){let a;switch(e.type){case 1:a=new lt(e,t);break;case 2:a=new nt(e,t);break;case 4:a=new ot(e,t);break;case 5:a=new rt(e,t);break;case 12:a=new ct(e,t);break;case 10:a=new dt(e,t);break;case 13:a=new ut(e,t);break;default:a=new ht(e,t)}return this.getList(t.camp).push(a),a}static clear(){this.playerSkills.length=0,this.enemySkills.length=0}};st.playerSkills=[],st.enemySkills=[];var ht=class{constructor(t,e){this.data=t,this.owner=e,this.name=t.name,this.condition=function(t){return t.condition&&t.condition.has("hp")?new it(t):new at(t)}(t),e.on(t.trigger.toString(),this,this.onTrigger)}onTrigger(){Y.updateBuffs(this.owner.camp+this.data.name),this.checkCondition()&&this.trigger()}trigger(){void 0!==this.data.buffRound&&Y.addBuff(this.owner,this.getTarget(),this.data)}checkCondition(){if(this.condition.check(this.owner)){let t;return"player"===this.owner.camp?t=R.zhandou.jineng1.toStr().replace("{p}",N.xinximoban.player).replace("{s}",N.xinximoban.skill):(t=R.zhandou.jineng2.toStr().replace("{e}",N.xinximoban.enemy).replace("{s}",N.xinximoban.skill),t=t.replace("^",Nt.getRoleName(this.owner.view.data))),t=t.replace("*",this.data.name.toStr()),t=t.replace("&",this.data.effectStr.toStr()),H.log(t,!1),!0}return!1}getTarget(){return 0==this.data.target?this.owner:this.owner.target}ban(){this.owner.off(this.data.trigger.toString(),this,this.onTrigger)}},lt=class extends ht{trigger(){let t=0,e=this.getTarget();if(this.data.values.has("1")){t=z(Number(this.data.values.get("1"))*this.owner.attack.value),e.takeDamage(this.owner,t)}if(this.data.values.has("2")){t=z(Number(this.data.values.get("2"))*vt.damage),e.takeDamage(this.owner,t)}}},nt=class extends ht{constructor(t,e){super(t,e),this.count=0,t.values.has("1")&&(this.count=Number(t.values.get("1")))}trigger(){if(this.count<1)return;this.count--;let t=this.getTarget();t.health.reset(),Y.clearByRevive(t)}},ot=class extends ht{trigger(){let t=this.getTarget(),e=t.attack.value;t.attack.init(t.defence.value),t.defence.init(e)}},rt=class extends ht{trigger(){let t=0,e=this.getTarget();this.data.values.has("1")&&(t=Number(this.data.values.get("1")),e.hurt+=t),this.data.values.has("2")&&(t=Number(this.data.values.get("2")),e.bear+=t)}},dt=class extends ht{trigger(){let t=0,e=this.getTarget();if(this.data.values.has("1")){t=z(this.data.values.get("1"));let a=st.getList(e.camp);this.getRandomSkills(a,t).forEach((t=>{t.ban(),a.splice(a.indexOf(t),1)}))}}getRandomSkills(t,e){const a=[...t].sort((()=>.5-Math.random()));return a.slice(0,Math.min(e,a.length))}},ct=class t extends ht{trigger(){let e=0,a=this.getTarget();if(this.data.values.has("1")){e=Number(this.data.values.get("1"));let i=k.table.Tbskill.getDataList(),s=st.getList(a.camp);t.getNewSkills(i,s,e).forEach((t=>{st.createSkill(a,t)}))}}static getNewSkills(t,e,a){const i=new Set(e.map((t=>t.data.id))),s=t.filter((t=>!i.has(t.id)));return this.getRandomSkills(s,a)}static getRandomSkills(t,e){const a=[...t].sort((()=>.5-Math.random()));return a.slice(0,Math.min(e,a.length))}},ut=class extends ht{trigger(){let t=0,e=this.getTarget();if("player"!==e.camp){if(this.data.values.has("1")){t=Number(this.data.values.get("1"));let a=k.table.Tbskill.getDataList(),i=st.getList(e.camp);ct.getNewSkills(a,i,t).forEach((t=>{st.createSkill(e,t)}))}if(this.data.values.has("2")){t=101-100;let a=k.table.Tbskill.getDataList(),i=st.getList(e.camp);ct.getNewSkills(a,i,t).forEach((t=>{st.createSkill(e,t)}))}}}},gt=class extends et{constructor(t,e){super(),this.view=e,this.hurt=0,this.bear=0,this.isBoss=!1,this.camp=t,this.health=new pt(((t,a)=>{var i,s;null==(i=e.hpBar)||i.setValue(a),this.isBoss&&(null==(s=Nt.instance.battle.bossHp)||s.setValue(a))})),this.attack=new ft(((t,e)=>{})),this.defence=new ft(((t,e)=>{}))}clear(){this.offAll()}init(t,e,a,i,s=!1){this.isBoss=s,this.attack.init(t),this.defence.init(e),this.health.init(a);for(let t of i){let e=k.table.Tbskill.get(t);e&&st.createSkill(this,e)}}round(t){return i(this,null,(function*(){Y.is(this,9)||(this.hurt=0,t.bear=0,yield this.dispatchAsync(3..toString()),yield this.dispatchAsync(4..toString()),yield t.dispatchAsync(7..toString()),yield this.dispatchAsync(5..toString()),yield t.dispatchAsync(8..toString()),yield this.attackAction(t))}))}attackAction(t){return i(this,null,(function*(){if(Y.is(this,8))return;let e=this.view.owner;e.parent.setChildIndex(e,e.parent.numChildren-1),this.view.play_anim(this.camp),yield j(100),Laya.SoundManager.playSound(k.sounds.get("att"));let a=!1;if(Y.is(t,6)&&(Y.is(this,7)||(a=!0)),Y.is(this,11)&&(t=t.target),vt.damage=z(t.getDamage(this.attack.value)*(1+this.hurt)*(1+t.bear)),vt.damage=Math.max(0,vt.damage),a||0===vt.damage)if(Laya.SoundManager.playSound(k.sounds.get("def")),a){let e;Z.showDodge(t.view),"player"===t.camp?e=R.zhandou.shanbi1.toStr().replace("p",N.xinximoban.player):(e=R.zhandou.shanbi2.toStr().replace("e",N.xinximoban.enemy),e=e.replace("*",Nt.getRoleName(t.view.data))),H.log(e,!1)}else{let e;Z.showBlock(t.view),"player"===t.camp?e=R.zhandou.gedang1.toStr().replace("p",N.xinximoban.player):(e=R.zhandou.gedang2.toStr().replace("e",N.xinximoban.enemy),e=e.replace("*",Nt.getRoleName(t.view.data))),H.log(e,!1)}else t.takeDamage(this,-vt.damage);yield j(100),yield this.dispatchAsync(6..toString()),a||(yield t.dispatchAsync(9..toString()))}))}getDamage(t){return Math.max(0,t-this.defence.value)}takeDamage(t,e){if(0!==e){if(this.health.add(e),e>0){let a;Z.showHeal(e,this.view),"player"===t.camp?a=R.zhandou.huifu1.toStr().replace("{p}",N.xinximoban.player).replace("{s}",N.xinximoban.huixue):(a=R.zhandou.huifu2.toStr().replace("{e}",N.xinximoban.enemy).replace("{s}",N.xinximoban.huixue),a=a.replace("*",Nt.getRoleName(this.view.data))),a=a.replace("&","+"+O(e)),H.log(a,!1)}if(e<0){let a;Z.showDamage(e,this.view),a="player"===t.camp?R.zhandou.huihe1.toStr().replace("{p}",N.xinximoban.player).replace("{s}",N.xinximoban.shanghai):R.zhandou.huihe2.toStr().replace("{e}",N.xinximoban.enemy).replace("{s}",N.xinximoban.shanghai),a=a.replace("*",Nt.getRoleName(this.view.data)),a=a.replace("&","-"+O(Math.abs(e))),H.log(a,!1)}}}isAlive(){return this.health.value>0}},ft=class{constructor(t){this.cur=0,this.max=0,this.callback=t}reset(){this.value=this.max}init(t){this.max=t,this.reset()}set value(t){this.cur=t,this.cur<0&&(this.cur=0),this.callback&&this.callback(this.cur,this.max)}get value(){return this.cur}add(t){this.value+=t}getMax(){return this.max}},pt=class extends ft{set value(t){this.cur=t,this.cur<0&&(this.cur=0),this.cur>this.max&&(this.cur=this.max),this.callback&&this.callback(this.cur,this.per=this.cur/this.max)}get value(){return this.cur}get original(){return this.max}addMax(t){this.max+=t,this.value+=t}},vt=class t{constructor(){this.bossHp=Nt.instance.Battle.getComponent(I),this.player=new gt("player",Nt.instance.Player.getComponent(U)),this.enemy=new gt("enemy",Nt.instance.Enemy.getComponent(U)),this.player.target=this.enemy,this.enemy.target=this.player}init(t,e,a){let i=$t.data.player,s=k.table.Tbrole.get(i.id),h=k.table.Tbrole_level.get(i.level),l=k.table.Tbrebirth.get($t.data.game.rebirth),n=Nt.getAddition(),o=Nt.getAttack(s,h,l,n),r=Nt.getDefence(s,h,l,n),d=Nt.getHealth(s,h,l,n);this.player.init(o,r,d,s.skills.concat(i.skills));let c=k.table.Tbmap_level.get(i.curScene);s=k.table.Tbrole.get(t),h=k.table.Tbrole_level.get(e),o=z(h.attack*s.attackRate*c.attackRate),r=z(h.defence*s.defenceRate*c.defenceRate),d=z(h.health*s.healthRate*c.healthRate),a&&(o=z(o*S),r=z(r*x),d=z(d*L)),Nt.instance.Enemy.getComponent(U).show_skin(a),this.bossHp.bg.visible=a,this.enemy.init(o,r,d,s.skills,a)}start(){return i(this,null,(function*(){H.log(R.zhandou.kaishi),Laya.SoundManager.playMusic(k.sounds.get("battle_bgm")),this.player.health.reset(),this.enemy.health.reset(),this.escape=!1;let e=this.player,a=this.enemy;for(e.dispatchAsync(1..toString()),a.dispatchAsync(1..toString()),e.dispatchAsync(2..toString()),a.dispatchAsync(2..toString()),yield j(200);!this.escape&&e.isAlive()&&a.isAlive();)t.damage=0,yield e.round(a),Y.clearTemp(),[e,a]=[a,e];if(st.clear(),Y.clear(),this.player.clear(),this.enemy.clear(),this.escape)H.log(R.zhandou.taopao);else if(this.player.isAlive()){if(H.log(R.zhandou.siwang1.toStr().replace("*",Nt.getRoleName(this.enemy.view.data)),!1),this.victory(this.enemy.view.data,this.enemy.view.level,this.enemy.isBoss),$t.data.setting.auto)return void Nt.instance.auto_fight();$t.saveGame()}else H.log(R.zhandou.siwang2.toStr().replace("*",Nt.getRoleName(this.enemy.view.data)),!1),Nt.player_dead();H.log(R.zhandou.jieshu),Laya.SoundManager.playMusic(k.sounds.get("bgm")),Nt.instance.show_map()}))}victory(t,e,a){Laya.SoundManager.playSound(k.sounds.get("win")),Dt.addCount("kill",t.id);let i=$t.data.player;i.scenes[i.curScene].count++;let s=k.table.Tbrole_level.get(e);Nt.addExp(s.exp*t.expDead),Nt.addValue(t),Nt.learn(t),a&&(V.tip("闯关成功！"),i.scenes[i.curScene].pass=1,i.maxScene=i.curScene,Dt.addCount("map"),Nt.instance.update_map()),Nt.instance.update_player()}},{regClass:mt}=Laya,yt=class extends Laya.Script{show(){let t=$t.data.player;this.refined=this.refining(),this.owner.getChildByName("list_shuxing").dataSource=Object.keys(t.relation).map((e=>{const a=e;let i=this.refined[e]-t.relation[e],s="";return i>0?s=`<font color=green>+${O(i)}</font>`:i<0&&(s=`<font size=18 color=red>-${O(Math.abs(i))}</font>`),`${$[a].toStr()}:<font color='#AFAFAF'>${O(t.relation[e])}</font> ${s}`})),this.owner.open()}onAwake(){this.owner.Label.text="是否消耗*级进行淬炼，淬炼后生物属性向当前物种靠拢。".toStr().replace("*",yt.level.toString()),this.owner.ok.onClick=()=>{let t=$t.data.player;t.level-=yt.level,t.relation=this.refined,Nt.instance.update_player(),this.owner.close(),V.tip(R.cuilian.toStr().replace("^",N.xinximoban.huixue),!1),Laya.SoundManager.playSound(k.sounds.get("upgrade")),$t.saveGame()},this.owner.no.onClick=()=>{this.owner.close()}}refining(){let t=$t.data.player,e=k.table.Tbrole.get(t.id);var a=t.relation,i=e.relations,s=Object.keys(a),h=0;s.forEach((t=>{h+=a[t]}));var l={};return s.forEach((t=>{var s,n=0,o=0,r=0,d=a[t],c=null!=(s=i[t])?s:0;d/h-3*c>0&&(n=-.1),d/h-.9*c<0&&(n=.1),d-c*e.race*2<0&&(o=.1),0==c&&(r=-.1),l[t]=z((n+o+r)*d)+d})),l}};yt.level=10,yt=a([mt("LOdO6nxVSaW9LKPr5KibAQ")],yt);var{regClass:wt}=Laya,bt=class extends Laya.Script{onAwake(){bt.instance=this,this.dingxiang=this.owner.getChildByName("dingxiang"),this.dingxiang.visible=!1,this.owner.no.onClick=()=>{this.owner.close()},this.owner.ok.onClick=()=>{this.dingxiang.visible=!0},this.ad=this.owner.getChildByName("ad"),this.ad.onClick=()=>{this.show(!0)}}show(t=!1){var e,a;t||this.owner.open(),this.ad.active=!t,this.owner.ok.active=$t.data.game.rebirth>1;let i=this.list_jinhua(t),s=this.owner.getChildByName("list_role");null==(e=s.renderHandler)||e.clear(),s.array=i[0],s.array.length=Math.min(i[0].length,6),s.renderHandler=Laya.Handler.create(this,((t,e)=>{let a=i[0][e];t.title.text=Nt.getRoleName(k.table.Tbrole.get(a[0]))+`\n<font color='#ffffff' size=24>${"成功率:".toStr()}${P(a[1])}</font>`,t.onClick=()=>{this.onClick(a[0],a[1])}}),null,!1);let h=this.dingxiang.getChildByName("list_dingxiang");h.scrollBar.autoHide=!0,null==(a=h.renderHandler)||a.clear(),h.array=i[1],h.renderHandler=Laya.Handler.create(this,((t,e)=>{let a=i[1][e];t.getChildByName("Title").text=Nt.getRoleName(k.table.Tbrole.get(a[0])),t.tip.text=`<font color='#ffffff' size=24>${"成功率:".toStr()}${P(a[1])}</font>`,t.onClick=()=>{this.onClick(a[0],a[1])}}),null,!1)}onClick(t,e){let a=$t.data.player;if(a.mimicry--,Math.random()<e){this.owner.close();let e=bt.getPower();bt.mimicry(t);let a=bt.getPower()-e,i="";i=a<0?`<font color=red>-${O(Math.abs(a))}</font>`:`<font color=green>+${O(a)}</font>`,V.show("战力：".toStr()+`${i}`,null,null,!1),Laya.SoundManager.playSound(k.sounds.get("upgrade"))}else{const t=.15;Math.random()<t?(Nt.player_dead(),V.tip(R.jinhua.shibai1.toStr().replace("^",N.xinximoban.shanghai),!1),this.owner.close()):(a.level=Math.max(1,a.level-10),V.tip(R.jinhua.shibai2.toStr().replace("^",N.xinximoban.shanghai),!1),a.level<=10&&this.owner.close())}Nt.instance.update_player(),Nt.instance.update_skill(),$t.saveGame()}static getPower(){let t=$t.data.player,e=k.table.Tbrole.get(t.id),a=k.table.Tbrole_level.get(t.level),i=k.table.Tbrebirth.get($t.data.game.rebirth),s=Nt.getAddition(),h=Nt.getAttack(e,a,i,s),l=Nt.getDefence(e,a,i,s),n=Nt.getHealth(e,a,i,s);return Nt.getPower(h,l,n)}static mimicry(t){let e=$t.data.player;var a=k.table.Tbrole.get(t),i=a.relations,s=e.relation;Object.keys(s).forEach((t=>{i[t]?s[t]=Math.floor(1.2*s[t]):s[t]=Math.floor(.8*s[t])})),e.id=t,e.forget=0,e.mimicry=1,$t.data.game.roles[t]||Nt.unlockRole(t),V.tip(R.jinhua.chenggong.toStr().replace("*",Nt.getRoleName(a)).replace("^",N.xinximoban.huixue),!1)}list_jinhua(t){let e=$t.data.player;var a=k.table.Tbrole.get(e.id).rare,i=function(t){let e=null,a=-1/0;for(const i in t)t[i]>a&&(a=t[i],e=i);return e}(e.quality),s=k.table.Tbrole.getDataList(),h=e.relation,l=Object.keys(h),n=0;l.forEach((t=>{n+=h[t]}));var o=new Map,r=new Map;s.forEach((e=>{if(!(Nt.isBoss(e)&&2!==$t.data.game.rewards.boss||e.rare<=a)){var s=1,d=e.relations;l.forEach((t=>{if(d[t]&&d[t]>0){var a=h[t]/(d[t]*e.race);a>1.2&&(a=1.2),a<.3&&(a=.3),s*=a}})),l.forEach((t=>{if(d[t]&&d[t]>0&&n>0){var e=h[t]/n/d[t];e>1&&(e=1),s*=e}})),t&&(s+=bt.ad_rate),"none"!==e.qualityType&&e.qualityType!==i||o.set(e.id,Math.min(s,1)),$t.data.game.roles[e.id]&&r.set(e.id,Math.min(s+.05,1))}}));let d=[];return d.push(Array.from(o).sort(((t,e)=>e[1]-t[1]))),d.push(Array.from(r).sort(((t,e)=>e[1]-t[1]))),d}};bt.ad_rate=.05,bt=a([wt("uU6pGiYKQOmXZ5kV8H6eUQ")],bt);var _t=class extends Laya.Scene{},{regClass:kt}=Laya,St=class extends Laya.Script{onAwake(){this.owner.ok.onClick=()=>{let t=$t.data.player,e=5*(t.forget+1);t.level<e?V.tip(R.buzu):(t.level-=e,t.forget+=1,V.tip("遗忘技能".toStr()+`·<font color='${N.xinximoban.skill}'>${this.data.name.toStr()}</font>`,!1),t.skills.splice(t.skills.indexOf(this.data.id),1),Nt.instance.update_player(),Nt.instance.update_skill(),this.owner.close(),$t.saveGame())},this.owner.no.onClick=()=>{this.owner.close()}}show(t,e){e?(this.owner.ok.visible=!0,this.owner.no.x=420):(this.owner.ok.visible=!1,this.owner.no.x=285),this.owner.parent.setChildIndex(this.owner,this.owner.parent.numChildren-1),this.data=t;let a=5*($t.data.player.forget+1);this.owner.ok.tip.text="需要等级>".toStr()+a,this.owner.Label.text=`<font color='#ffe900' size=40>${t.name.toStr()}</font>\n\n${t.description.toStr()}`,this.owner.open()}};St=a([kt("TeBj67zKTwymfmLpcRf_Aw")],St);var{regClass:xt}=Laya,Lt=class extends Laya.Script{onStart(){let t=this.owner;t.color="#FF4900",t.onClick=()=>{this.data&&Nt.instance.SkillTip.getComponent(St).show(this.data,this.isForget)}}show(t,e=!1){var a,i;this.isForget=e,this.data=k.table.Tbskill.get(t),t&&!this.data||(this.owner.title.text=null!=(i=null==(a=this.data)?void 0:a.name.toStr())?i:"")}};Lt=a([xt("vdLRBex-Roidhl5M9zhxuA")],Lt);var{regClass:Tt}=Laya,Ct=class extends Laya.Script{onAwake(){this.owner.color="#545454",this.owner.onClick=()=>{Et.instance.show_role(this.data)}}show(t){this.data=t,this.owner.title.text=$t.data.game.roles[this.data.id]?Nt.getRoleName(this.data):`${Nt.getQualityStr(this.data.qualityType).toStr()}·${this.data.name.toStr()}`}};Ct=a([Tt("0iiTFqnPTyC5E64Nz3i2Fg")],Ct);var{regClass:Mt}=Laya,Et=class extends Laya.Script{onAwake(){Et.instance=this,this.owner.no.onClick=()=>{Nt.instance.update_skill(),Nt.instance.update_player(),this.owner.close(),$t.saveGame()},this.owner.ok.onClick=()=>{k.table.Tbachieve.getDataList().forEach((t=>{1===$t.data.game.achieves[t.id]&&Dt.reward(t)})),Nt.instance.Tujian.getComponent(Et).show(!1)}}show(t=!0){var e,a;t&&this.owner.open();let i="",s=0,h=k.table.Tbachieve.getDataList();h.forEach((t=>{$t.data.game.achieves[t.id]>0&&s++})),i+="成就完成率:".toStr()+P(s/h.length),s=0;let l=k.table.Tbrole.getDataList();l.forEach((t=>{$t.data.game.roles[t.id]&&s++})),i+="\n"+"图鉴完成率:".toStr()+P(s/l.length),this.owner.Label.text=i;let n=this.owner.getChildByName("list_chengjiu");n.scrollBar.autoHide=!0,null==(e=n.renderHandler)||e.clear(),n.array=h,n.renderHandler=Laya.Handler.create(this,((t,e)=>{t.getComponent(Dt).show(e+1)}),null,!1);let o=this.owner.getChildByName("list_tujian");o.scrollBar.autoHide=!0,null==(a=o.renderHandler)||a.clear(),o.array=l,o.renderHandler=Laya.Handler.create(this,((t,e)=>{t.getComponent(Ct).show(l[e])}),null,!1),this.show_role(k.table.Tbrole.get("h1"))}show_role(t){var e,a;this.owner.getChildByName("Name").text=Nt.getRoleName(t);let i=!$t.data.game.roles[t.id],s="";t.rare<4&&i&&(s="击杀解锁".toStr()+`\n(${$t.data.game.kills[t.id]}/${E[t.rare-1]})`),Nt.isBoss(t)&&0===$t.data.game.rewards.boss&&(s="无法拟态需成就解锁".toStr()),this.owner.getChildByName("Lock").text=s,this.owner.getChildByName("Chengzhang").text=`${"攻击成长:".toStr()}<font color='#78D658'>${t.attackRate}</font>\n${"防御成长:".toStr()}<font color='#78D658'>${t.defenceRate}</font>\n${"血量成长:".toStr()}<font color='#78D658'>${t.healthRate}</font>`,this.owner.getChildByName("Jiacheng").text=`${"攻击:".toStr()}<font color='#ffffff'>${O(t.attackAdd)}</font>\n${"防御:".toStr()}<font color='#ffffff'>${O(t.defenceAdd)}</font>\n${"血量:".toStr()}<font color='#ffffff'>${O(t.healthAdd)}</font>`;let h=this.owner.getChildByName("list_shuxing");var l=t.relations,n=t.race*t.remain*M;let o=[];for(let a in t.relations){var r=z((null!=(e=l[a])?e:0)*n);const t=a;r>0&&o.push(`${$[t].toStr()}:<font color='#ffffff'>${i?"???":O(r)}</font>`)}h.dataSource=o;let d=this.owner.getChildByName("list_skill");d.scrollBar.autoHide=!0,null==(a=d.renderHandler)||a.clear(),d.dataSource=t.skills,d.renderHandler=Laya.Handler.create(this,((e,a)=>{e.getComponent(Lt).show(t.skills[a])}),null,!1)}};Et=a([Mt("qiBKDC1JT7uCFMZAu-ASTg")],Et);var{regClass:Bt}=Laya,Nt=class extends _t{show(){this.getChildByName("Top").visible=!0,this.getChildByName("Middle").visible=!0,this.getChildByName("Bottom").visible=!0}onAwake(){Nt.instance=this,this.battle=new vt,this.list_guyou.scrollBar.autoHide=!0,this.list_xuexi.scrollBar.autoHide=!0,this.show_map(),this.update_player(),this.update_skill(),this.btn_jineng.onClick=()=>{this.img_jineng.visible=!0,this.img_shuxing.visible=!1},this.btn_shuxing.onClick=()=>{this.img_jineng.visible=!1,this.img_shuxing.visible=!0},this.btn_sousuo.onClick=()=>{this.update_map()},this.btn_boss.onClick=()=>{let t=$t.data.player.scenes[$t.data.player.curScene];Nt.instance.Enemy.getComponent(U).show(t.boss,t.level),Nt.instance.show_battle(t.boss,t.level,!0)},this.btn_shenru.onClick=()=>{$t.data.player.curScene++,H.log(R.shenru.toStr().replace("*",q($t.data.player.curScene)),!1),Nt.instance.update_map(),$t.saveGame()},H.log(R.shenru.toStr().replace("*",q($t.data.player.curScene)),!1),this.btn_fanhui.onClick=()=>{$t.data.player.curScene--,H.log(R.shenru.toStr().replace("*",q($t.data.player.curScene)),!1),Nt.instance.update_map(),$t.saveGame()},this.btn_taopao.onClick=()=>{let t=$t.data.setting.auto;this.battle.escape=!0,$t.data.setting.auto=!1,this.update_auto(),t&&$t.saveGame()},this.btn_tujian.onClick=()=>{this.Tujian.getComponent(Et).show()},this.btn_jinhua.onClick=()=>{let t=$t.data.player,e=k.table.Tbrole.get(t.id),a=B[Math.min(B.length-1,e.rare)];$t.data.player.level>a?this.Jinhua.getComponent(bt).show():V.tip(R.buzu)},this.btn_cuilian.onClick=()=>{$t.data.player.level>yt.level?this.Cuilian.getComponent(yt).show():V.tip(R.buzu)},this.btn_zhuansheng.onClick=()=>{let t=$t.data.game.rebirth;if(t>999)return void V.tip("<font color='#FF0000'>已达到最大转生数</font>");let e=k.table.Tbrebirth.get(0===t?1:t);if($t.data.player.level<=e.need)return void V.tip(R.buzu);let a=10;t>99&&(a=1),t>199&&(a=.1),V.show("是否进行转生，等级、种族重置为初始状态，全属性永久额外增加".toStr()+`${a}%`,(()=>{if($t.data.game.rebirth++,1==$t.data.game.rebirth&&V.show("解锁：自动战斗".toStr(),null,null,!1),2==$t.data.game.rebirth&&V.show("解锁：定向拟态".toStr(),null,null,!1),3==$t.data.game.rebirth){var t=k.table.Tbskill.get("jiexi");V.show("习得：".toStr()+`${t.name.toStr()}`,null,null,!1)}$t.data.player=$t.reset(),V.tip(R.zhuansheng.toStr().replace("^",N.xinximoban.huixue),!1),Dt.addCount("rebirth"),Laya.SoundManager.playSound(k.sounds.get("upgrade")),this.show_map(),this.update_player(),this.update_skill(),$t.saveGame()}))},this.List.array=H.get(),H.instance.callback=()=>{this.List.refresh(),this.List.scrollTo(this.List.array.length-1)},this.List.scrollBar.autoHide=!0,this.btn_zidong.onClick=()=>{$t.data.setting.auto=!$t.data.setting.auto,$t.data.setting.auto?this.auto_fight():this.battle.escape=!0,this.update_auto()},this.update_auto()}update_auto(){this.btn_zidong.title.text=($t.data.setting.auto?"停止":"自动战斗").toStr()}auto_fight(){let t=k.table.Tbmap_level.get($t.data.player.curScene),e=Nt.getMonsterByScene(t),a=Nt.getLevel(t);this.Enemy.getComponent(U).show(e,a),this.show_battle(e,a,!1)}show_map(){this.Map.visible=!0,this.Battle.visible=!1,this.update_map()}show_battle(t,e,a){this.Map.visible=!1,this.Battle.visible=!0,this.battle.init(t,e,a),this.battle.start()}update_player(){var t,e,a;let i=$t.data.player,s=k.table.Tbrole.get(i.id),h=k.table.Tbrole_level.get(i.level),l=k.table.Tbrebirth.get($t.data.game.rebirth),n=Nt.getAddition(),o=Nt.getAttack(s,h,l,n),r=Nt.getDefence(s,h,l,n),d=Nt.getHealth(s,h,l,n),c=Nt.getPower(o,r,d),u=i.exp,g=s.expNeed*h.need,f=Nt.getRoleName(s);this.label_1.text="种族:".toStr()+`${f}\n${"战力:".toStr()}${O(c)}\n${"等级:".toStr()}${i.level}(${P(u/g)})\n${"转生:".toStr()}${$t.data.game.rebirth}\n<font color='#6FD368'>${"灵气:".toStr()}${O(null!=(t=i.quality.ling)?t:0)}</font>\n<font color='#D7AC5E'>${"仙气:".toStr()}${O(null!=(e=i.quality.xian)?e:0)}</font>\n<font color='#C26060'>${"神韵:".toStr()}${O(null!=(a=i.quality.shen)?a:0)}</font>`,this.label_2.text=`${"攻击:".toStr()}<font color='#DCDCDC'>${O(o)}</font>\t${"防御:".toStr()}<font color='#DCDCDC'>${O(r)}</font>\n${"血量:".toStr()}<font color='#DCDCDC'>${O(d)}</font>`,this.list_shuxing.dataSource=Object.keys(i.relation).map((t=>`${$[t].toStr()}:<font color='#AFAFAF'>${O(i.relation[t])}</font>`)),this.player0.getComponent(U).show(i.id,i.level,c),this.Player.getComponent(U).show(i.id,i.level),this.btn_zidong.active=$t.data.game.rebirth>0,this.btn_cuilian.tip.text="需要等级>".toStr()+yt.level,this.btn_zhuansheng.tip.text="需要等级>".toStr()+l.need,this.btn_jinhua.tip.text="需要等级>".toStr()+B[Math.min(B.length-1,s.rare)],H.log(R.zhandouli.toStr().replace("*",O(c)),!1)}update_skill(){var t,e;let a=$t.data.player,i=k.table.Tbrole.get(a.id);null==(t=this.list_guyou.renderHandler)||t.clear(),null==(e=this.list_xuexi.renderHandler)||e.clear(),this.list_guyou.array=i.skills,this.list_guyou.renderHandler=Laya.Handler.create(this,((t,e)=>{t.getComponent(Lt).show(i.skills[e])}),null,!1);let s=a.skills.concat(new Array(Nt.getSkillMax()-a.skills.length).fill(""));this.list_xuexi.array=s,this.list_xuexi.renderHandler=Laya.Handler.create(this,((t,e)=>{t.getComponent(Lt).show(s[e],!0)}),null,!1)}update_map(){let t=$t.data.player.curScene;this.label_titile.text="第*层".toStr().replace("*",q(t));let e=k.table.Tbmap_level.get(t),a=$t.data.player.scenes[t];a.count>=3?(this.btn_sousuo.tip.text="",this.btn_shenru.active=!0,this.btn_boss.visible=!a.pass,this.btn_shenru.visible=a.pass>0):(this.btn_sousuo.tip.text="击败怪物:".toStr()+`${a.count}/3`,this.btn_shenru.active=!1,this.btn_boss.visible=!1),1==t?this.btn_fanhui.active=!1:(this.btn_fanhui.active=!0,t>=105&&(this.btn_shenru.active=!1));var i=Nt.getMonsterListByScene(e);this.monster0.getComponent(U).init(e,i[0],Nt.getLevel(e)),this.monster1.getComponent(U).init(e,i[1],Nt.getLevel(e)),this.monster2.getComponent(U).init(e,i[2],Nt.getLevel(e));let s=R.qianjin.toStr();i.forEach(((t,e)=>{s=s.replace(`{${e}}`,Nt.getRoleName(k.table.Tbrole.get(t)))})),H.log(s,!1)}static player_dead(){Laya.SoundManager.playSound(k.sounds.get("die")),$t.data.setting.auto=!1,this.instance.update_auto();let t=V.show("<font color='^'>你死了</font>等级将降为1级".toStr().replace("^",N.xinximoban.shanghai),(()=>{$t.data.player.revive--,V.tip("<font color='^'>你复活了</font>".toStr().replace("^",N.xinximoban.huixue),!1),Laya.SoundManager.playSound(k.sounds.get("upgrade")),$t.saveGame()}),(()=>{V.tip("<font color='^'>你死了</font>,等级降为1级".toStr().replace("^",N.xinximoban.shanghai),!1),$t.data.player.level=1,$t.data.player.exp=0,Nt.instance.update_player(),$t.saveGame()}));$t.data.player.revive<=0?t.ok.active=!1:(t.ok.active=!0,t.ok.title.text="复活".toStr(),t.ok.tip.text="剩余次数:".toStr()+`${$t.data.player.revive}`)}static getRoleName(t){let e=N.pinzhi[t.qualityType],a=N.name[t.rare];return`<font color=${e}>${this.getQualityStr(t.qualityType).toStr()}</font><font color=${N.name.dian}>·</font><font color=${a}>${t.name.toStr()}</font>`}static getQualityStr(t){return"ling"===t?"灵":"xian"===t?"仙":"shen"==t?"神":"凡"}static getSkillMax(){let t=$t.data.player,e=k.table.Tbrole.get(t.id),a=1;return e.skills.concat(t.skills).forEach((t=>{let e=k.table.Tbskill.get(t);13===e.type&&(a+=e.values.get("1"))})),a+=$t.data.game.rewards.skill,a}static getLevelMax(){return 99+10*$t.data.game.rewards.level}static addExp(t){let e=$t.data.player,a=z(e.exp+t),i=k.table.Tbrole_level.get(e.level),s=k.table.Tbrole.get(e.id);for(;;){const t=i.need*s.expNeed;if(!(a>=t))break;a-=t,this.addLevel()}e.exp=a}static addLevel(){let t=$t.data.player;t.level>=this.getLevelMax()?V.tip("已达到最高等级！"):(t.level++,V.tip("等级+1"),H.log(R.shengji.toStr().replace("*",t.level.toString()),!1))}static addValue(t){var e,a;let i=$t.data.player;var s=z(t.quality*M);i.quality[t.qualityType]=(null!=(e=i.quality[t.qualityType])?e:0)+s;var h=i.relation,l=t.relations,n=Object.keys(h),o=t.race*t.remain*M,r="";for(let t=0;t<n.length;t++){const e=n[t];var d=z((null!=(a=l[e])?a:0)*o);if(h[e]+=d,d>0){r+=`${$[e].toStr()}:+${d}，\t\t`}}r.length>0&&(r=r.substring(0,r.lastIndexOf("，\t\t"))),V.tip(r,!1)}static unlockRole(t){let e=k.table.Tbrole.get(t);V.tip("解锁图鉴：".toStr()+`${this.getRoleName(e)}`,!1),$t.data.game.roles[t]=1}static learn(t){if(Math.random()>.2)return;let e=this.getSkillMax(),a=$t.data.player,i=k.table.Tbrole.get(a.id).skills.concat(a.skills);if(a.skills.length>=e)return void V.tip("技能已满！");const s=new Set(i),h=[...t.skills.filter((t=>!s.has(t)))].sort((()=>.5-Math.random())),l=h.slice(0,Math.min(1,h.length));if(l.length>0){const e=l[0],i=k.table.Tbskill.get(e);i&&(a.skills.push(e),V.tip(R.tunshi.toStr().replace("*",Nt.getRoleName(t)).replace("&",i.name.toStr()).replace("^",N.xinximoban.skill),!1),Nt.instance.update_skill())}}static getAddition(){let t={attack:0,defence:0,health:0};return k.table.Tbrole.getDataList().forEach((e=>{$t.data.game.roles[e.id]&&(t.attack+=e.attackAdd,t.defence+=e.defenceAdd,t.health+=e.healthAdd)})),t}static getAttack(t,e,a,i){let s;return s=e.attack*t.attackRate*(1+a.attack),s+=i.attack,z(s*T)}static getDefence(t,e,a,i){let s;return s=e.defence*t.defenceRate*(1+a.defence),s+=i.defence,z(s*T)}static getHealth(t,e,a,i){let s;return s=e.health*t.healthRate*(1+a.health),s+=i.health,z(s*T)}static getPower(t,e,a){return z((t+e)*C+a)}static isBoss(t){return 0===t.id.indexOf("b")}static getBoss(t){return t.id>100?"b"+(t.id-100):this.getMonsterByScene(t)}static getMonsterByScene(t){var e,a,i=t.monsters,s=0;for(var h in i)s+=null!=(e=i[h])?e:0;let l=z(Math.random()*s),n=0;for(let t in i)if(n+=null!=(a=i[t])?a:0,l<n)return t;return null}static getMonsterListByScene(t){var e=t.monsters;const a=Object.keys(e).map((t=>({key:t,value:e[t]})));if(0===a.length)return[];for(let t=a.length-1;t>0;t--){const e=z(Math.random()*(t+1));[a[t],a[e]]=[a[e],a[t]]}const i=a.reduce(((t,e)=>{var a;return t+(null!=(a=e.value)?a:0)}),0);if(i<=0)return[];const s=new Set;let h=0;for(;s.size<3&&h<1e3;){h++;let t=Math.random()*i,e=0;for(const{key:i,value:h}of a)if(e+=null!=h?h:0,t<e){s.add(i);break}}return Array.from(s)}static getLevel(t){return Math.round(Math.random()*(t.levelMax-t.levelMin))+t.levelMin}};Nt=a([Bt("gFM8IGO1T4aKS_u8PMeg9g")],Nt);var Rt=class t{static reset(t="h1"){var e;let a={id:t,quality:{none:0},relation:{chi:0,hui:0,lin:0,mao:0,jia:0,luo:0,yu:0,zhao:0,ti:0,jiao:0,zhi:0},exp:0,level:1,forget:0,revive:3,mimicry:1,skills:[],curScene:1,maxScene:0,scenes:{}};return k.table.Tbmap_level.getDataList().forEach((t=>{a.scenes[t.id]={count:0,pass:0,boss:Nt.getBoss(t),level:Nt.getLevel(t)}})),(null==(e=this.data)?void 0:e.game.rebirth)>=3&&a.skills.push("jiexi"),a}static newGame(){let e={player:t.reset("h1"),game:{isNew:!0,rebirth:0,roles:{},kills:{},achieves:{},rewards:{level:0,skill:0,boss:0}},setting:{auto:!1,mute:!1,music:.5,sound:.5}};return k.table.Tbrole.getDataList().forEach((t=>{e.game.roles[t.id]=0,e.game.kills[t.id]=0})),e.game.roles[e.player.id]=1,k.table.Tbachieve.getDataList().forEach((t=>{e.game.achieves[t.id]=0})),e}static init(){this.data=this.loadGame()}static saveGame(){try{const e=JSON.stringify(this.data);Laya.LocalStorage.setItem(t.SAVE_KEY,e),H.log("存档保存成功!")}catch(t){}}static loadGame(){try{const e=Laya.LocalStorage.getItem(t.SAVE_KEY);if(e)return H.log("存档加载成功!"),JSON.parse(e)}catch(t){}return this.newGame()}static deleteSave(){Laya.LocalStorage.removeItem(t.SAVE_KEY)}};Rt.SAVE_KEY="game_save";var $t=Rt,{regClass:At}=Laya,Dt=class extends Laya.Script{onAwake(){this.owner.onClick=()=>{Dt.reward(this.data),Nt.instance.Tujian.getComponent(Et).show(!1)}}show(t){let e=k.table.Tbachieve.get(t);this.data=e;let a,i=this.owner.getChildByName("Frame"),s=i.getChildByName("Title"),h=i.getChildByName("Tip"),l=Dt.getCount(e),n=e.count;l<n?(a=`(${l}/${n})`,h.color="#6AB548"):(a="完成".toStr(),h.color="#c58237"),h.text=a,s.text=e.description.toStr(),this.owner.tip.text=e.rewardStr.toStr();let o=$t.data.game.achieves[t];1===o?(this.owner.title.text="领取奖励".toStr(),this.owner.active=!0):(this.owner.title.text=2===o?"已领取".toStr():"未完成".toStr(),this.owner.active=!1)}static reward(t){if($t.data.game.achieves[t.id]=2,"random"===t.rewardType){var e=k.table.Tbrole.getDataList().filter((t=>!$t.data.game.roles[t.id]));if(e.length>0){var a=e[Math.floor(Math.random()*e.length)];Nt.unlockRole(a.id)}else V.tip("所有图鉴已解锁")}else V.tip(t.rewardStr),$t.data.game.rewards[t.rewardType]++}static getCount(t){return"map"===t.type?$t.data.player.maxScene:"rebirth"===t.type?$t.data.game.rebirth:"kill"===t.type?$t.data.game.kills[t.target]:0}static addCount(t,e){let a=k.table.Tbachieve.getDataList(),i=$t.data.game.achieves;if(e){$t.data.game.kills[e]++;var s=k.table.Tbrole.get(e);s.rare<4&&!$t.data.game.roles[e]&&$t.data.game.kills[e]>=E[s.rare-1]&&Nt.unlockRole(e)}a.forEach((a=>{i[a.id]>0||a.type===t&&("map"===t&&a.count<=$t.data.player.maxScene||"rebirth"===t&&a.count<=$t.data.game.rebirth||e&&"kill"===t&&a.target===e&&a.count<=$t.data.game.kills[e])&&(i[a.id]=1,V.show("达成：".toStr()+`${a.description.toStr()}`,null,null,!1))}))}};Dt=a([At("3TX1KPIcRt2UJAt_EmF5Pg")],Dt);var{regClass:Ht}=Laya,jt=class extends Laya.Script{onAwake(){this.owner.text=this.owner.text.toStr()}};jt=a([Ht("lyjYBkxSTa2FXWv6tWLNKQ")],jt);var{regClass:zt}=Laya,Pt=class extends Laya.Script{onAwake(){this.Button=this.owner.getChildByName("Button"),this.Sound=this.owner.getChildByName("Sound"),this.ComboBox=this.owner.getChildByName("ComboBox");const t=["CHS","EN","CHT","JP","KR","TH","VN"];this.ComboBox.dataSource=["简体中文","English","繁體中文","日本語","한국어","ภาษาไทย","Tiếng Việt"],this.ComboBox.selectedIndex=t.indexOf(D.key),this.ComboBox.visibleNum=t.length,this.ComboBox.selectHandler=Laya.Handler.create(this,(e=>{let a=t[this.ComboBox.selectedIndex];D.setLanguage(a),Laya.Scene.open("Scene.ls")}),null,!1),this.Button.onClick=()=>{Nt.instance.show(),this.owner.destroy()},this.update_sound(),this.Sound.onClick=()=>{$t.data.setting.mute=!$t.data.setting.mute,this.update_sound()}}update_sound(){Laya.SoundManager.muted=$t.data.setting.mute,$t.data.setting.mute?(this.Sound.image.skin="resources/image/off.png",Laya.SoundManager.stopMusic()):(this.Sound.image.skin="resources/image/on.png",Laya.SoundManager.playMusic(k.sounds.get("bgm")))}};Pt=a([zt("TlP4VuJYRPGWMB0BrP_Qew")],Pt);var Ot=class extends Laya.Sprite{},{regClass:qt}=Laya,Ft=class extends Ot{constructor(){super(...arguments),this.isPressed=!1,this.color="#FF2929"}onAwake(){this.image=this.getChildByName("Image"),this.title=this.image.getChildByName("Title"),this.tip=this.getChildByName("Tip"),this.image.on(Laya.Event.MOUSE_DOWN,this,this.onPress),this.image.on(Laya.Event.MOUSE_UP,this,this.onRelease),this.image.on(Laya.Event.MOUSE_OUT,this,this.onRelease),this.originalColor=this.image.color}onDestroy(){this.image.off(Laya.Event.MOUSE_DOWN,this,this.onPress),this.image.off(Laya.Event.MOUSE_UP,this,this.onRelease),this.image.off(Laya.Event.MOUSE_OUT,this,this.onRelease)}onEnable(){this.image.disabled=!1}onDisable(){this.image.disabled=!0}onPress(){this.isPressed=!0,this.image.color=this.color,Laya.Tween.to(this.image,{scaleX:.9,scaleY:.9},100,Laya.Ease.quadIn),Laya.SoundManager.playSound(k.sounds.get("ui_anniu"))}onRelease(){if(this.image.color=this.originalColor,this.isPressed&&(this.isPressed=!1,this.image.hitTestPoint(Laya.stage.mouseX,Laya.stage.mouseY)))return Laya.SoundManager.playSound(k.sounds.get("ui_anniu2")),void Laya.Tween.to(this.image,{scaleX:1,scaleY:1},100,Laya.Ease.quadOut,Laya.Handler.create(this,(()=>{this.onClick&&this.onClick()})));Laya.Tween.to(this.image,{scaleX:1,scaleY:1},100)}};Ft=a([qt("mk3vMNXVSGieSd9t6-NHxg")],Ft);var Gt=class extends Laya.Box{},{regClass:It}=Laya,Kt=class extends Gt{open(){this.visible=!0,this.scale(0,0),this.alpha=0,Laya.Tween.to(this,{scaleX:1,scaleY:1,alpha:1},300,Laya.Ease.backOut)}close(t){Laya.Tween.to(this,{scaleX:0,scaleY:0,alpha:0},300,Laya.Ease.backOut,Laya.Handler.create(this,(()=>{t?t():this.visible=!1})))}};Kt=a([It("NpR6WP_JT4u_-iaEnCk4lA")],Kt),window.$_main_=function(){return i(this,null,(function*(){yield k.load_config(),D.init();let t=Laya.stage.addChild(new Laya.Label);t.dataSource={width:Laya.stage.width-60,height:Laya.stage.height-60,wordWrap:!0,align:"center",valign:"middle",fontSize:30,color:"#ffffff"},t.text=A[Math.floor(Math.random()*A.length)].toStr(),yield k.load_sound(),yield k.load_prefab(),H.log("----------开局一只史莱姆----------"),$t.init(),yield Laya.Scene.open("Scene.ls"),null==t||t.destroy()}))}})();