"use strict";(()=>{var t=Object.defineProperty,e=Object.getOwnPropertyDescriptor,a=(a,i,s,o)=>{for(var l,h=o>1?void 0:o?e(i,s):i,n=a.length-1;n>=0;n--)(l=a[n])&&(h=(o?l(i,s,h):l(h))||h);return o&&h&&t(i,s,h),h},i=(t,e,a)=>new Promise(((i,s)=>{var o=t=>{try{h(a.next(t))}catch(t){s(t)}},l=t=>{try{h(a.throw(t))}catch(t){s(t)}},h=t=>t.done?i(t.value):Promise.resolve(t.value).then(o,l);h((a=a.apply(t,e)).next())})),s=class{constructor(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.type)throw new Error;if(this.type=t.type,null!=t.target?this.target=t.target:this.target=void 0,void 0===t.count)throw new Error;if(this.count=t.count,void 0===t.description)throw new Error;if(this.description=t.description,void 0===t.reward_type)throw new Error;if(this.rewardType=t.reward_type,void 0===t.reward_str)throw new Error;this.rewardStr=t.reward_str}resolve(t){}},o=class{constructor(t){if(void 0===t.key)throw new Error;if(this.key=t.key,void 0===t.CHS)throw new Error;if(this.CHS=t.CHS,void 0===t.EN)throw new Error;if(this.EN=t.EN,void 0===t.CHT)throw new Error;if(this.CHT=t.CHT,void 0===t.JP)throw new Error;if(this.JP=t.JP,void 0===t.KR)throw new Error;if(this.KR=t.KR,void 0===t.VN)throw new Error;this.VN=t.VN}resolve(t){}},l=class{constructor(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.level_min)throw new Error;if(this.levelMin=t.level_min,void 0===t.level_max)throw new Error;if(this.levelMax=t.level_max,void 0===t.health_rate)throw new Error;if(this.healthRate=t.health_rate,void 0===t.defence_rate)throw new Error;if(this.defenceRate=t.defence_rate,void 0===t.attack_rate)throw new Error;if(this.attackRate=t.attack_rate,void 0===t.monsters)throw new Error;this.monsters=new h(t.monsters)}resolve(t){var e;null==(e=this.monsters)||e.resolve(t)}},h=class{constructor(t){null!=t.h1?this.h1=t.h1:this.h1=void 0,null!=t.h2?this.h2=t.h2:this.h2=void 0,null!=t.h13?this.h13=t.h13:this.h13=void 0,null!=t.h14?this.h14=t.h14:this.h14=void 0,null!=t.h36?this.h36=t.h36:this.h36=void 0,null!=t.h137?this.h137=t.h137:this.h137=void 0,null!=t.h3?this.h3=t.h3:this.h3=void 0,null!=t.h15?this.h15=t.h15:this.h15=void 0,null!=t.h28?this.h28=t.h28:this.h28=void 0,null!=t.h37?this.h37=t.h37:this.h37=void 0,null!=t.h45?this.h45=t.h45:this.h45=void 0,null!=t.h55?this.h55=t.h55:this.h55=void 0,null!=t.h72?this.h72=t.h72:this.h72=void 0,null!=t.h82?this.h82=t.h82:this.h82=void 0,null!=t.h90?this.h90=t.h90:this.h90=void 0,null!=t.h96?this.h96=t.h96:this.h96=void 0,null!=t.h104?this.h104=t.h104:this.h104=void 0,null!=t.h108?this.h108=t.h108:this.h108=void 0,null!=t.h121?this.h121=t.h121:this.h121=void 0,null!=t.h129?this.h129=t.h129:this.h129=void 0,null!=t.h138?this.h138=t.h138:this.h138=void 0,null!=t.h4?this.h4=t.h4:this.h4=void 0,null!=t.h16?this.h16=t.h16:this.h16=void 0,null!=t.h17?this.h17=t.h17:this.h17=void 0,null!=t.h29?this.h29=t.h29:this.h29=void 0,null!=t.h38?this.h38=t.h38:this.h38=void 0,null!=t.h46?this.h46=t.h46:this.h46=void 0,null!=t.h53?this.h53=t.h53:this.h53=void 0,null!=t.h56?this.h56=t.h56:this.h56=void 0,null!=t.h62?this.h62=t.h62:this.h62=void 0,null!=t.h73?this.h73=t.h73:this.h73=void 0,null!=t.h83?this.h83=t.h83:this.h83=void 0,null!=t.h91?this.h91=t.h91:this.h91=void 0,null!=t.h97?this.h97=t.h97:this.h97=void 0,null!=t.h105?this.h105=t.h105:this.h105=void 0,null!=t.h109?this.h109=t.h109:this.h109=void 0,null!=t.h116?this.h116=t.h116:this.h116=void 0,null!=t.h122?this.h122=t.h122:this.h122=void 0,null!=t.h126?this.h126=t.h126:this.h126=void 0,null!=t.h130?this.h130=t.h130:this.h130=void 0,null!=t.h135?this.h135=t.h135:this.h135=void 0,null!=t.h139?this.h139=t.h139:this.h139=void 0,null!=t.h5?this.h5=t.h5:this.h5=void 0,null!=t.h18?this.h18=t.h18:this.h18=void 0,null!=t.h30?this.h30=t.h30:this.h30=void 0,null!=t.h39?this.h39=t.h39:this.h39=void 0,null!=t.h47?this.h47=t.h47:this.h47=void 0,null!=t.h57?this.h57=t.h57:this.h57=void 0,null!=t.h63?this.h63=t.h63:this.h63=void 0,null!=t.h74?this.h74=t.h74:this.h74=void 0,null!=t.h84?this.h84=t.h84:this.h84=void 0,null!=t.h88?this.h88=t.h88:this.h88=void 0,null!=t.h92?this.h92=t.h92:this.h92=void 0,null!=t.h98?this.h98=t.h98:this.h98=void 0,null!=t.h106?this.h106=t.h106:this.h106=void 0,null!=t.h110?this.h110=t.h110:this.h110=void 0,null!=t.h117?this.h117=t.h117:this.h117=void 0,null!=t.h123?this.h123=t.h123:this.h123=void 0,null!=t.h127?this.h127=t.h127:this.h127=void 0,null!=t.h131?this.h131=t.h131:this.h131=void 0,null!=t.h140?this.h140=t.h140:this.h140=void 0,null!=t.h6?this.h6=t.h6:this.h6=void 0,null!=t.h19?this.h19=t.h19:this.h19=void 0,null!=t.h20?this.h20=t.h20:this.h20=void 0,null!=t.h31?this.h31=t.h31:this.h31=void 0,null!=t.h40?this.h40=t.h40:this.h40=void 0,null!=t.h48?this.h48=t.h48:this.h48=void 0,null!=t.h54?this.h54=t.h54:this.h54=void 0,null!=t.h58?this.h58=t.h58:this.h58=void 0,null!=t.h64?this.h64=t.h64:this.h64=void 0,null!=t.h75?this.h75=t.h75:this.h75=void 0,null!=t.h85?this.h85=t.h85:this.h85=void 0,null!=t.h93?this.h93=t.h93:this.h93=void 0,null!=t.h99?this.h99=t.h99:this.h99=void 0,null!=t.h107?this.h107=t.h107:this.h107=void 0,null!=t.h111?this.h111=t.h111:this.h111=void 0,null!=t.h118?this.h118=t.h118:this.h118=void 0,null!=t.h124?this.h124=t.h124:this.h124=void 0,null!=t.h128?this.h128=t.h128:this.h128=void 0,null!=t.h132?this.h132=t.h132:this.h132=void 0,null!=t.h7?this.h7=t.h7:this.h7=void 0,null!=t.h21?this.h21=t.h21:this.h21=void 0,null!=t.h22?this.h22=t.h22:this.h22=void 0,null!=t.h23?this.h23=t.h23:this.h23=void 0,null!=t.h32?this.h32=t.h32:this.h32=void 0,null!=t.h41?this.h41=t.h41:this.h41=void 0,null!=t.h49?this.h49=t.h49:this.h49=void 0,null!=t.h59?this.h59=t.h59:this.h59=void 0,null!=t.h65?this.h65=t.h65:this.h65=void 0,null!=t.h76?this.h76=t.h76:this.h76=void 0,null!=t.h86?this.h86=t.h86:this.h86=void 0,null!=t.h89?this.h89=t.h89:this.h89=void 0,null!=t.h94?this.h94=t.h94:this.h94=void 0,null!=t.h100?this.h100=t.h100:this.h100=void 0,null!=t.h112?this.h112=t.h112:this.h112=void 0,null!=t.h119?this.h119=t.h119:this.h119=void 0,null!=t.h125?this.h125=t.h125:this.h125=void 0,null!=t.h133?this.h133=t.h133:this.h133=void 0,null!=t.h136?this.h136=t.h136:this.h136=void 0,null!=t.h8?this.h8=t.h8:this.h8=void 0,null!=t.h9?this.h9=t.h9:this.h9=void 0,null!=t.h24?this.h24=t.h24:this.h24=void 0,null!=t.h25?this.h25=t.h25:this.h25=void 0,null!=t.h33?this.h33=t.h33:this.h33=void 0,null!=t.h42?this.h42=t.h42:this.h42=void 0,null!=t.h50?this.h50=t.h50:this.h50=void 0,null!=t.h60?this.h60=t.h60:this.h60=void 0,null!=t.h66?this.h66=t.h66:this.h66=void 0,null!=t.h68?this.h68=t.h68:this.h68=void 0,null!=t.h77?this.h77=t.h77:this.h77=void 0,null!=t.h87?this.h87=t.h87:this.h87=void 0,null!=t.h95?this.h95=t.h95:this.h95=void 0,null!=t.h101?this.h101=t.h101:this.h101=void 0,null!=t.h102?this.h102=t.h102:this.h102=void 0,null!=t.h113?this.h113=t.h113:this.h113=void 0,null!=t.h120?this.h120=t.h120:this.h120=void 0,null!=t.h134?this.h134=t.h134:this.h134=void 0,null!=t.h10?this.h10=t.h10:this.h10=void 0,null!=t.h26?this.h26=t.h26:this.h26=void 0,null!=t.h34?this.h34=t.h34:this.h34=void 0,null!=t.h43?this.h43=t.h43:this.h43=void 0,null!=t.h51?this.h51=t.h51:this.h51=void 0,null!=t.h61?this.h61=t.h61:this.h61=void 0,null!=t.h67?this.h67=t.h67:this.h67=void 0,null!=t.h69?this.h69=t.h69:this.h69=void 0,null!=t.h70?this.h70=t.h70:this.h70=void 0,null!=t.h71?this.h71=t.h71:this.h71=void 0,null!=t.h78?this.h78=t.h78:this.h78=void 0,null!=t.h79?this.h79=t.h79:this.h79=void 0,null!=t.h80?this.h80=t.h80:this.h80=void 0,null!=t.h81?this.h81=t.h81:this.h81=void 0,null!=t.h103?this.h103=t.h103:this.h103=void 0,null!=t.h114?this.h114=t.h114:this.h114=void 0,null!=t.h11?this.h11=t.h11:this.h11=void 0,null!=t.h12?this.h12=t.h12:this.h12=void 0,null!=t.h27?this.h27=t.h27:this.h27=void 0,null!=t.h35?this.h35=t.h35:this.h35=void 0,null!=t.h44?this.h44=t.h44:this.h44=void 0,null!=t.h52?this.h52=t.h52:this.h52=void 0,null!=t.h115?this.h115=t.h115:this.h115=void 0}resolve(t){}},n=class{constructor(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.need)throw new Error;if(this.need=t.need,void 0===t.health)throw new Error;if(this.health=t.health,void 0===t.attack)throw new Error;if(this.attack=t.attack,void 0===t.defence)throw new Error;this.defence=t.defence}resolve(t){}},r=class{constructor(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.name)throw new Error;if(this.name=t.name,void 0===t.rare)throw new Error;if(this.rare=t.rare,void 0===t.quality_type)throw new Error;if(this.qualityType=t.quality_type,void 0===t.quality)throw new Error;if(this.quality=t.quality,void 0===t.race)throw new Error;if(this.race=t.race,void 0===t.remain)throw new Error;if(this.remain=t.remain,void 0===t.exp_need)throw new Error;if(this.expNeed=t.exp_need,void 0===t.exp_dead)throw new Error;if(this.expDead=t.exp_dead,void 0===t.attack_rate)throw new Error;if(this.attackRate=t.attack_rate,void 0===t.defence_rate)throw new Error;if(this.defenceRate=t.defence_rate,void 0===t.health_rate)throw new Error;if(this.healthRate=t.health_rate,void 0===t.attack_add)throw new Error;if(this.attackAdd=t.attack_add,void 0===t.defence_add)throw new Error;if(this.defenceAdd=t.defence_add,void 0===t.health_add)throw new Error;if(this.healthAdd=t.health_add,void 0===t.relations)throw new Error;if(this.relations=new c(t.relations),void 0===t.skills)throw new Error;this.skills=[];for(let e of t.skills){let t;t=e,this.skills.push(t)}}resolve(t){var e;null==(e=this.relations)||e.resolve(t)}},d=class{constructor(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.need)throw new Error;if(this.need=t.need,void 0===t.exp)throw new Error;if(this.exp=t.exp,void 0===t.attack)throw new Error;if(this.attack=t.attack,void 0===t.defence)throw new Error;if(this.defence=t.defence,void 0===t.health)throw new Error;this.health=t.health}resolve(t){}},c=class{constructor(t){null!=t.chi?this.chi=t.chi:this.chi=void 0,null!=t.hui?this.hui=t.hui:this.hui=void 0,null!=t.lin?this.lin=t.lin:this.lin=void 0,null!=t.mao?this.mao=t.mao:this.mao=void 0,null!=t.jia?this.jia=t.jia:this.jia=void 0,null!=t.luo?this.luo=t.luo:this.luo=void 0,null!=t.yu?this.yu=t.yu:this.yu=void 0,null!=t.zhao?this.zhao=t.zhao:this.zhao=void 0,null!=t.ti?this.ti=t.ti:this.ti=void 0,null!=t.jiao?this.jiao=t.jiao:this.jiao=void 0,null!=t.zhi?this.zhi=t.zhi:this.zhi=void 0}resolve(t){}},u=class{constructor(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.name)throw new Error;if(this.name=t.name,void 0===t.effect_str)throw new Error;if(this.effectStr=t.effect_str,void 0===t.description)throw new Error;if(this.description=t.description,void 0===t.rarity)throw new Error;if(this.rarity=t.rarity,void 0===t.type)throw new Error;if(this.type=t.type,void 0===t.target)throw new Error;if(this.target=t.target,void 0===t.trigger)throw new Error;if(this.trigger=t.trigger,void 0===t.condition)throw new Error;for(var e of(this.condition=new Map,t.condition)){let t,a;t=e[0],a=e[1],this.condition.set(t,a)}if(null!=t.buff_round?this.buffRound=t.buff_round:this.buffRound=void 0,void 0===t.rate)throw new Error;if(this.rate=t.rate,void 0===t.values)throw new Error;for(var e of(this.values=new Map,t.values)){let t,a;t=e[0],a=e[1],this.values.set(t,a)}}resolve(t){}},g=class{constructor(t){for(var e of(this._dataMap=new Map,this._dataList=[],t)){let t;t=new s(e),this._dataList.push(t),this._dataMap.set(t.id,t)}}getDataMap(){return this._dataMap}getDataList(){return this._dataList}get(t){return this._dataMap.get(t)}resolve(t){for(let e of this._dataList)e.resolve(t)}},f=class{constructor(t){for(var e of(this._dataMap=new Map,this._dataList=[],t)){let t;t=new o(e),this._dataList.push(t),this._dataMap.set(t.key,t)}}getDataMap(){return this._dataMap}getDataList(){return this._dataList}get(t){return this._dataMap.get(t)}resolve(t){for(let e of this._dataList)e.resolve(t)}},p=class{constructor(t){for(var e of(this._dataMap=new Map,this._dataList=[],t)){let t;t=new l(e),this._dataList.push(t),this._dataMap.set(t.id,t)}}getDataMap(){return this._dataMap}getDataList(){return this._dataList}get(t){return this._dataMap.get(t)}resolve(t){for(let e of this._dataList)e.resolve(t)}},v=class{constructor(t){for(var e of(this._dataMap=new Map,this._dataList=[],t)){let t;t=new n(e),this._dataList.push(t),this._dataMap.set(t.id,t)}}getDataMap(){return this._dataMap}getDataList(){return this._dataList}get(t){return this._dataMap.get(t)}resolve(t){for(let e of this._dataList)e.resolve(t)}},m=class{constructor(t){for(var e of(this._dataMap=new Map,this._dataList=[],t)){let t;t=new r(e),this._dataList.push(t),this._dataMap.set(t.id,t)}}getDataMap(){return this._dataMap}getDataList(){return this._dataList}get(t){return this._dataMap.get(t)}resolve(t){for(let e of this._dataList)e.resolve(t)}},y=class{constructor(t){for(var e of(this._dataMap=new Map,this._dataList=[],t)){let t;t=new d(e),this._dataList.push(t),this._dataMap.set(t.id,t)}}getDataMap(){return this._dataMap}getDataList(){return this._dataList}get(t){return this._dataMap.get(t)}resolve(t){for(let e of this._dataList)e.resolve(t)}},w=class{constructor(t){for(var e of(this._dataMap=new Map,this._dataList=[],t)){let t;t=new u(e),this._dataList.push(t),this._dataMap.set(t.id,t)}}getDataMap(){return this._dataMap}getDataList(){return this._dataList}get(t){return this._dataMap.get(t)}resolve(t){for(let e of this._dataList)e.resolve(t)}},b=class{get Tbachieve(){return this._Tbachieve}get Tblang(){return this._Tblang}get Tbmap_level(){return this._Tbmap_level}get Tbrebirth(){return this._Tbrebirth}get Tbrole(){return this._Tbrole}get Tbrole_level(){return this._Tbrole_level}get Tbskill(){return this._Tbskill}constructor(t){this._Tbachieve=new g(t("tbachieve")),this._Tblang=new f(t("tblang")),this._Tbmap_level=new p(t("tbmap_level")),this._Tbrebirth=new v(t("tbrebirth")),this._Tbrole=new m(t("tbrole")),this._Tbrole_level=new y(t("tbrole_level")),this._Tbskill=new w(t("tbskill")),this._Tbachieve.resolve(this),this._Tblang.resolve(this),this._Tbmap_level.resolve(this),this._Tbrebirth.resolve(this),this._Tbrole.resolve(this),this._Tbrole_level.resolve(this),this._Tbskill.resolve(this)}},_=class t{static load_config(){return i(this,null,(function*(){const e=["resources/json/tbachieve.json","resources/json/tblang.json","resources/json/tbmap_level.json","resources/json/tbrebirth.json","resources/json/tbrole.json","resources/json/tbrole_level.json","resources/json/tbskill.json"];yield Laya.loader.load(e,Laya.Loader.JSON).then((e=>{let a=0;t.table=new b((()=>e[a++].data)),console.log("加载配置表成功！")})).catch((t=>{console.error("加载配置表失败",t)})),e.forEach((t=>{Laya.loader.clearRes(t)}))}))}static load_sound(){return i(this,null,(function*(){this.sounds.set("bgm","resources/sound/bgm.mp3"),this.sounds.set("ui_anniu","resources/sound/ui_anniu.mp3"),this.sounds.set("ui_anniu2","resources/sound/ui_anniu2.mp3"),this.sounds.set("die","resources/sound/die.mp3"),this.sounds.set("upgrade","resources/sound/upgrade.mp3"),this.sounds.set("win","resources/sound/win.mp3"),this.sounds.set("battle_bgm","resources/sound/battle_bgm.mp3"),this.sounds.set("att0","resources/sound/att0.mp3"),this.sounds.set("def0","resources/sound/def0.mp3"),this.sounds.set("att1","resources/sound/att1.mp3"),this.sounds.set("def1","resources/sound/def1.mp3"),this.sounds.set("att2","resources/sound/att2.mp3"),this.sounds.set("def2","resources/sound/def2.mp3"),yield Laya.loader.load(Array.from(this.sounds.values()))}))}static load_prefab(){return i(this,null,(function*(){this.prefabs.set("PopUp","resources/prefab/PopUp.lh"),yield Laya.loader.load(Array.from(this.prefabs.values()))}))}};_.sounds=new Map,_.prefabs=new Map;var S=_,k=1.2,L=1.2,x=2,C=1.05,M=10,T=.1,$=[100,150,200],E=[10,20,30,40,45,50,55,60,65],R={xinximoban:{shanghai:"#ff0200",huixue:"#5aff00",player:"#e1ffd5",enemy:"#ffe8e4",skill:"#fffe00"},pinzhi:{none:"#bfbfbf",ling:"#00b0f0",xian:"#ffff00",shen:"#ff0000"},name:{hui:"#bfbfbf",dian:"#bfbfbf",0:"#bfbfbf",1:"#ffffff",2:"#90ee90",3:"#06b400",4:"#8ea9db",5:"#00b0f0",6:"#7030a0",7:"#ffff00",8:"#ffc000",9:"#ff0000"}},B={zhandou:{kaishi:"----------开始战斗----------",jineng1:"<font color='{p}'>你使用了技能·<font color='{s}'>*</font>,&</font>",jineng2:"<font color='{e}'>^使用了技能·<font color='{s}'>*</font>,&</font>",shanbi1:"<font color='{p}'>你闪避了!</font>",shanbi2:"<font color='{e}'>*闪避了!</font>",gedang1:"<font color='{p}'>你格挡了!</font>",gedang2:"<font color='{e}'>*格挡了!</font>",huihe1:"<font color='{p}'>你对*发动了攻击,造成了<font color='{s}'>&</font>点伤害.</font>",huihe2:"<font color='{e}'>*对你发动了攻击,造成了<font color='{s}'>&</font>点伤害.</font>",huifu1:"<font color='{p}'>你恢复了<font color='{s}'>&</font>点生命.</font>",huifu2:"<font color='{e}'>*恢复了<font color='{s}'>&</font>点生命.</font>",siwang1:"你吞噬了*.",siwang2:"*吞噬了你.",jieshu:"----------战斗结束----------",taopao:"你逃出生天!"},jinhua:{chenggong:"<font color='^'>拟态成功</font>,拟态为*",shibai1:"<font color='^'>拟态失败</font>,肉身崩坏死亡！",shibai2:"<font color='^'>拟态失败</font>,损失等级10级。"},qianjin:"你遇到了{0},{1},{2}!",zhandouli:"当前战斗力为:<font color='#ff8c00'>*</font>",shenru:"你来到第*层.",shengji:"你的等级为:*.",zhuansheng:"<font color='^'>转生成功</font>,属性成长提升",cuilian:"<font color='^'>淬炼成功</font>,属性向拟态生物靠拢",tunshi:"你吞噬了*,解析成功获得技能·<font color='^'>&</font>",buzu:"<font color='#FF0000'>等级不足</font>"},N={chi:"齿",hui:"喙",lin:"鳞",mao:"毛",jia:"甲",luo:"蠃",yu:"羽",zhao:"爪",ti:"蹄",jiao:"角",zhi:"智"},D=["拟态失败有可能死亡，拟态需谨慎","转生3次后，史莱姆会获得专属技能“解析”","拟态时，属性匹配度越高、属性值越高成功率越高","自动战斗可不一定是什么好事","偷偷说一下，人族非常厉害","淬炼可以让属性变得更纯粹","拟态只会拟态成灵属性最高或无属性的生物","已解锁的图鉴会给史莱姆提供属性加成","等级超过99级后升级获得的属性会大幅下降","所有生物20%概率吞噬敌人获得新的技能","转生超过99次、199次后转生获得的属性会大幅下降"];String.prototype.toStr=function(){if(!this)return this;let t=S.table.Tblang.get(this);return t?t[A.key]:(console.log(`未找到语言：${this}`),this)};var A=class t{static init(){t.key=Laya.LocalStorage.getItem("language")||"CHS"}static setLanguage(e){t.key=e,Laya.LocalStorage.setItem("language",e)}},j=class t{constructor(t=1e3){this.maxLength=t,this.logs=[],this.maxLength=t}add(t){this.logs.length>=this.maxLength&&this.logs.shift(),this.logs.push(t),this.callback&&this.callback()}static log(e,a=!0){a&&(e=e.toStr()),this.instance||(this.instance=new t),this.instance.add(e),console.log(`[LOG]: ${e}`)}static get(){return this.instance.logs}static clear(){this.instance.logs.length=0}};function H(t){return Math.floor(t)}function z(t){return`${Math.floor(1e3*t)/10}%`}function O(t){let e,a;"CHS"===A.key&&(e=["万","亿","兆"]),"CHT"===A.key&&(e=["萬","億","兆"]),"JP"===A.key&&(e=["万","億","兆"]),"KR"===A.key&&(e=["만","억","조"]),a=e?[{value:1e12,symbol:e[2]},{value:1e8,symbol:e[1]},{value:1e4,symbol:e[0]}]:[{value:1e12,symbol:"T"},{value:1e9,symbol:"B"},{value:1e6,symbol:"M"},{value:1e3,symbol:"K"}];for(const e of a)if(t>=e.value){return(t/e.value).toFixed(2).replace(/\.?0+$/,"")+e.symbol}return t.toString()}function P(t){return t.toString()}var q=class t{static tip(e,a=!0){if(e){a&&(e=e.toStr());var i=50*this.tipsQueue.length;j.log(e,!1);var s=new Laya.Label;s.text=e,s.fontSize=36,s.color="#ffffff",s.pos(Laya.stage.width/2,Laya.stage.height/2+i),s.alpha=1,s.align="center",s.valign="middle",s.anchorX=.5,s.anchorY=.5,s.width=540,s.wordWrap=!0,s.html=!0,Laya.stage.addChild(s),Laya.Tween.to(s,{scaleX:1.5,scaleY:1.5},200,Laya.Ease.quadIn,Laya.Handler.create(s,(function(){Laya.Tween.to(s,{scaleX:1,scaleY:1},200,Laya.Ease.quadOut),Laya.Tween.to(s,{y:Laya.stage.height/2-100+i,alpha:0},1e3,Laya.Ease.linearNone,Laya.Handler.create(s,(function(){s.removeSelf(),t.tipsQueue.shift()})))}))),t.tipsQueue.push(s)}}static show(t,e,a,i=!0,s=!0){let o=Laya.loader.getRes(S.prefabs.get("PopUp")).create();return Laya.stage.addChild(o),o.Label.text=t,o.open(),i?(o.ok.visible=!0,o.no.x=420):(o.ok.visible=!1,o.no.x=285,o.no.title.text="确认".toStr(),j.log(t,!1)),o.ok.onClick=()=>{s&&o.close((()=>{o.destroy()})),e&&e()},o.no.onClick=()=>{s&&o.close((()=>{o.destroy()})),a&&a()},o}};q.tipsQueue=[];var F=q;function G(t){let e,a,i,s,o;if(t<1&&(console.error("Level ID must be at least 1"),t=1),t<=99)e=50*(t-1)+100,a=5*(t-1)+50,i=Math.round(1e3*Math.pow(1.1,t-1)),s=Math.round(500*Math.pow(1.1,t-1)),o=Math.round(5e3*Math.pow(1.1,t-1));else{let l=5e3,h=540,n=11387094,r=5702813,d=56947219;e=Math.round(l*Math.pow(1.05,t-99)),a=Math.round(h*Math.pow(1.05,t-99)),i=Math.round(n*Math.pow(1.01,t-99)),s=Math.round(r*Math.pow(1.01,t-99)),o=Math.round(d*Math.pow(1.01,t-99))}return{id:t,need:e,exp:a,attack:i,defence:s,health:o}}var{regClass:I}=Laya,V=class extends Laya.Script{constructor(){super(...arguments),this.isAd=!1}onAwake(){V.instance=this,this.dingxiang=this.owner.getChildByName("dingxiang"),this.dingxiang.visible=!1,this.owner.no.onClick=()=>{this.owner.close(),this.isAd=!1},this.owner.ok.onClick=()=>{this.dingxiang.visible=!0},this.ad=this.owner.getChildByName("ad"),U()&&(this.ad.tip.text="看广告 +5%".toStr()),this.ad.onClick=()=>{console.log("广告时刻"),U()?(this.ad.active=!1,Y(2)):(this.isAd=!0,this.show(!1))}}ad_load(){this.ad.active=!0}ad_success(){this.isAd=!0,this.show(!1)}show(t=!0){var e,a;t&&this.owner.open(),U()?this.ad.active=!this.isAd:(this.ad.active=!this.isAd&&Z.data.player.mimicry>0,this.ad.tip.text="+5% 次数:".toStr()+(this.isAd?0:`${Z.data.player.mimicry}`)),this.owner.ok.active=Z.data.game.rebirth>1;let i=this.list_jinhua(),s=this.owner.getChildByName("list_role");null==(e=s.renderHandler)||e.clear(),s.array=i[0],s.array.length=Math.min(i[0].length,6),s.renderHandler=Laya.Handler.create(this,((t,e)=>{let a=i[0][e];t.title.text=Ft.getRoleName(S.table.Tbrole.get(a[0]))+`\n<font color='#ffffff' size=24>${"成功率:".toStr()}${z(a[1])}</font>`,t.onClick=()=>{this.onClick(a[0],a[1])}}),null,!1);let o=this.dingxiang.getChildByName("list_dingxiang");o.scrollBar.autoHide=!0,null==(a=o.renderHandler)||a.clear(),o.array=i[1],o.renderHandler=Laya.Handler.create(this,((t,e)=>{let a=i[1][e];t.getChildByName("Title").text=Ft.getRoleName(S.table.Tbrole.get(a[0])),t.tip.text=`<font color='#ffffff' size=24>${"成功率:".toStr()}${z(a[1])}</font>`,t.onClick=()=>{this.onClick(a[0],a[1])}}),null,!1)}onClick(t,e){let a=Z.data.player;if(!U()&&this.isAd?(this.isAd=!1,a.mimicry=0):this.isAd=!1,Math.random()<e){this.owner.close();let e=V.getPower();V.mimicry(t);let a=V.getPower()-e,i="";i=a<0?`<font color=red>-${O(Math.abs(a))}</font>`:`<font color=green>+${O(a)}</font>`,F.show("战力：".toStr()+`${i}`,null,null,!1),Laya.SoundManager.playSound(S.sounds.get("upgrade"))}else{const t=.15;Math.random()<t?(Ft.instance.player_dead(),F.tip(B.jinhua.shibai1.toStr().replace("^",R.xinximoban.shanghai),!1),this.owner.close()):(a.level=Math.max(1,a.level-10),F.tip(B.jinhua.shibai2.toStr().replace("^",R.xinximoban.shanghai),!1),this.show(!1),a.level<=10&&this.owner.close())}Ft.instance.update_player(),Ft.instance.update_skill(),Z.saveGame()}static getPower(){let t=Z.data.player,e=S.table.Tbrole.get(t.id),a=G(t.level),i=S.table.Tbrebirth.get(Z.data.game.rebirth),s=Ft.getAddition(),o=Ft.getAttack(e,a,i,s),l=Ft.getDefence(e,a,i,s),h=Ft.getHealth(e,a,i,s);return Ft.getPower(o,l,h)}static mimicry(t){let e=Z.data.player;var a=S.table.Tbrole.get(t),i=a.relations,s=e.relation;Object.keys(s).forEach((t=>{i[t]?s[t]=Math.floor(1.2*s[t]):s[t]=Math.floor(.8*s[t])})),e.id=t,e.forget=0,e.revive=3,e.mimicry=1,Z.data.game.roles[t]||Ft.unlockRole(t),F.tip(B.jinhua.chenggong.toStr().replace("*",Ft.getRoleName(a)).replace("^",R.xinximoban.huixue),!1)}list_jinhua(){let t=Z.data.player;var e=S.table.Tbrole.get(t.id).rare,a=function(t){if(t.ling===t.xian&&t.ling===t.shen)return"none";let e="none",a=0;for(const i in t)"none"!==i&&t[i]>a&&(a=t[i],e=i);return e}(t.quality),i=S.table.Tbrole.getDataList(),s=t.relation,o=Object.keys(s),l=0;o.forEach((t=>{l+=s[t]}));var h=new Map,n=new Map;i.forEach((t=>{if(!(Ft.isBoss(t)&&2!==Z.data.game.rewards.boss||t.rare<=e)){var i=1,r=t.relations;o.forEach((e=>{if(r[e]&&r[e]>0){var a=s[e]/(r[e]*t.race);a>1.2&&(a=1.2),a<.3&&(a=.3),i*=a}})),o.forEach((t=>{if(r[t]&&r[t]>0&&l>0){var e=s[t]/l/r[t];e>1&&(e=1),i*=e}})),this.isAd&&(i+=V.ad_rate),t.qualityType===a&&h.set(t.id,Math.min(i,1)),Z.data.game.roles[t.id]&&n.set(t.id,Math.min(i+.05,1))}}));let r=[];return r.push(Array.from(h).sort(((t,e)=>e[1]-t[1]))),r.push(Array.from(n).sort(((t,e)=>e[1]-t[1]))),r}};V.ad_rate=.05,V=a([I("uU6pGiYKQOmXZ5kV8H6eUQ")],V);var{regClass:J,property:K}=Laya,X=class extends Laya.Script{onDestroy(){X.instance=null}showLogin(t){t?(this.Login.visible=!0,this.TapTap.visible=!1):(this.Login.visible=!1,this.TapTap.visible=!0)}onAwake(){X.instance=this,this.Login=this.owner.getChildByName("Login"),this.TapTap=this.owner.getChildByName("TapTap"),this.TapTap.onClick=()=>{window.Android.login()},U()?this.showLogin(X.isLogin):this.showLogin(!0);const t=["CHS","EN","CHT","JP","KR","VN"];this.ComboBox.dataSource=["简体中文","English","繁體中文","日本語","한국어","Tiếng Việt"],this.ComboBox.selectedIndex=t.indexOf(A.key),this.ComboBox.visibleNum=t.length,this.Delete.onClick=()=>{F.show("是否删除存档？".toStr(),(()=>{Z.data=Z.newGame(),Z.saveGame()}))},this.Scene1.onClick=()=>{Laya.Scene.open("Scene.ls")},this.settings.onClick=()=>{this.settingsPanel.open()},this.no.onClick=()=>{this.settingsPanel.close()},this.ok.onClick=()=>{let e=t[this.ComboBox.selectedIndex];A.setLanguage(e),Z.data.setting.music=this.musicBar.value/100,Z.data.setting.sound=this.soundBar.value/100,Laya.SoundManager.setMusicVolume(Z.data.setting.music),Laya.SoundManager.setSoundVolume(Z.data.setting.sound),Laya.SoundManager.soundMuted=0===Z.data.setting.sound,Laya.SoundManager.musicMuted=0===Z.data.setting.music;let a=this.sys_tog.selected?"system":"default";Laya.Config.defaultFont="system"===a?null:"AlimamaDaoLiTi",Laya.LocalStorage.setItem("font",a),Z.saveGame(),Laya.Scene.open("Login.ls")},this.sys_tog.clickHandler=Laya.Handler.create(this,(()=>{this.sys_tog.selected=!0,this.sel_tog.selected=!1}),null,!1),this.sel_tog.clickHandler=Laya.Handler.create(this,(()=>{this.sys_tog.selected=!1,this.sel_tog.selected=!0}),null,!1),null===Laya.Config.defaultFont?this.sel_tog.selected=!0:this.sys_tog.selected=!0,Laya.SoundManager.setMusicVolume(Z.data.setting.music),Laya.SoundManager.setSoundVolume(Z.data.setting.sound),Laya.SoundManager.playMusic(S.sounds.get("bgm")),Laya.SoundManager.soundMuted=0===Z.data.setting.sound,Laya.SoundManager.musicMuted=0===Z.data.setting.music,this.musicBar.value=100*Z.data.setting.music,this.soundBar.value=100*Z.data.setting.sound;let e=Laya.LocalStorage.getItem("font");this.sys_tog.selected=!!e&&"system"===e,this.sel_tog.selected=!this.sys_tog.selected;let a=t=>{ae.data=t,Laya.Scene.open("Scene2.ls")};this.Scene2.onClick=()=>{let t=function(t){try{const e=Laya.LocalStorage.getItem(t);if(e)return j.log("存档加载成功!"),JSON.parse(e);console.log("No saved found.")}catch(t){console.error("Failed to load game:",t)}return null}("endless");if(t){let e=F.show("发现存档，是否继续游戏进度？".toStr(),(()=>{a({id:"h1",level:1,skills:[],curScene:0,refresh:3,revive:3,roles:{},isNew:!0})}),(()=>{a(t)}));e.ok.title.text="重新开始".toStr(),e.no.title.text="继续".toStr()}else a({id:"h1",level:1,skills:[],curScene:0,refresh:3,revive:3,roles:{},isNew:!0})},this.sys_tog.label="手机".toStr(),this.sel_tog.label="游戏".toStr()}};function U(){return void 0!==window.Android}function Y(t){window.Android.playAd(t)}function Q(t){Laya.stage.destroyChildren(),t&&(Z.data=t),Laya.Scene.open("Login.ls",!1,null,Laya.Handler.create(null,(()=>{U()&&window.Android.loaded()})))}a([K({type:Laya.Sprite})],X.prototype,"Scene1",2),a([K({type:Laya.Sprite})],X.prototype,"Scene2",2),a([K({type:Laya.Sprite})],X.prototype,"Delete",2),a([K({type:Laya.Sprite})],X.prototype,"settings",2),a([K({type:Laya.ComboBox})],X.prototype,"ComboBox",2),a([K({type:Laya.Sprite})],X.prototype,"settingsPanel",2),a([K({type:Laya.Sprite})],X.prototype,"ok",2),a([K({type:Laya.Sprite})],X.prototype,"no",2),a([K({type:Laya.HSlider})],X.prototype,"musicBar",2),a([K({type:Laya.HSlider})],X.prototype,"soundBar",2),a([K({type:Laya.Radio})],X.prototype,"sys_tog",2),a([K({type:Laya.Radio})],X.prototype,"sel_tog",2),X=a([J("TlP4VuJYRPGWMB0BrP_Qew")],X),window.onTapTapLogin=function(t){var e;console.log("onTapTapLogin",t),X.isLogin=t,null==(e=X.instance)||e.showLogin(t)},window.onAdLoaded=function(t){var e,a;1==t?null==(e=Ft.instance)||e.fuhuo_load():2==t&&(null==(a=V.instance)||a.ad_load())},window.onAdRewarded=function(t){var e,a;1==t?null==(e=Ft.instance)||e.fuhuo_success():2==t&&(null==(a=V.instance)||a.ad_success())},window.onAdNotReady=function(t){F.show("广告未准备好!".toStr(),(()=>{Y(t)})).ok.title.text="再次发送".toStr()},window.changeData=function(t){let e=Z.newGame();if(t){let a=e.game,i=e.player;i.id=0===t.name.indexOf("b")?t.name:"h"+t.name,i.level=t.level,i.exp=t.jingyan,i.quality.ling=t.ling,i.quality.xian=t.xian,i.quality.shen=t.shen,i.relation.chi=t.chi,i.relation.hui=t.hui,i.relation.lin=t.lin,i.relation.mao=t.mao,i.relation.jia=t.jia,i.relation.luo=t.luo,i.relation.yu=t.yu,i.relation.zhao=t.zhao,i.relation.ti=t.ti,i.relation.jiao=t.jiao,i.relation.zhi=t.zhi,i.forget=t.yiwang,a.rebirth=t.lun-1,i.curScene=Number(t.curScene.name.split("_")[1]),i.maxScene=Number(t.curScene.maxScene.split("_")[1]);for(const a in t.scenes){const i=t.scenes[a];let s=e.player.scenes[a.split("_")[1]];s&&(s.count=i.count,s.pass=1===i.islock?0:1,0!==s.boss.indexOf("b")&&(s.boss="h"+i.boss),s.level=i.level)}for(const e in t.heroes)0===e.indexOf("b")?a.roles[e]=t.heroes[e]:a.roles["h"+e]=t.heroes[e];for(const e in t.jisha)0===e.indexOf("b")?a.kills[e]=t.jisha[e]:a.kills["h"+e]=t.jisha[e];t.skills.forEach((t=>{S.table.Tbskill.get(t)&&i.skills.push(t)}))}Q(e)},window.onerror=function(t,e,a,i,s){console.error("JS Error:",t,"at",e,a+":"+i)};var W=class t{static reset(t="h1"){var e;let a={id:t,quality:{none:0},relation:{chi:0,hui:0,lin:0,mao:0,jia:0,luo:0,yu:0,zhao:0,ti:0,jiao:0,zhi:0},exp:0,level:1,forget:0,revive:3,mimicry:1,skills:[],curScene:1,maxScene:0,scenes:{}};return S.table.Tbmap_level.getDataList().forEach((t=>{a.scenes[t.id]={count:0,pass:0,boss:Ft.getBoss(t),level:Ft.getLevel(t)}})),(null==(e=this.data)?void 0:e.game.rebirth)>=3&&a.skills.push("jiexi"),a}static newGame(){let e={player:t.reset("h1"),game:{isNew:!0,rebirth:0,roles:{},kills:{},achieves:{},rewards:{level:0,skill:0,boss:0}},setting:{auto:!1,mute:!1,music:.5,sound:.5}};return S.table.Tbrole.getDataList().forEach((t=>{e.game.roles[t.id]=0,e.game.kills[t.id]=0})),e.game.roles[e.player.id]=1,S.table.Tbachieve.getDataList().forEach((t=>{e.game.achieves[t.id]=0})),e}static init(){let t=this.loadGame();if(!t){if(U())return void window.Android.loadOldData();t=this.newGame()}Q(t)}static saveGame(){try{const e=JSON.stringify(this.data);Laya.LocalStorage.setItem(t.SAVE_KEY,e),j.log("存档保存成功!")}catch(t){console.error("Failed to save game:",t)}}static loadGame(){try{const e=Laya.LocalStorage.getItem(t.SAVE_KEY);if(e)return j.log("存档加载成功!"),JSON.parse(e);console.log("No saved found.")}catch(t){console.error("Failed to load game:",t)}return null}static deleteSave(){Laya.LocalStorage.removeItem(t.SAVE_KEY),console.log("Save deleted successfully!")}};W.SAVE_KEY="game_save";var Z=W,{regClass:tt}=Laya,et=class extends Laya.Script{onAwake(){this.owner.color="#545454",this.owner.onClick=()=>{ht.instance.show_role(this.data)}}show(t){this.data=t,this.owner.title.text=Z.data.game.roles[this.data.id]?Ft.getRoleName(this.data):`${Ft.getQualityStr(this.data.qualityType).toStr()}·${this.data.name.toStr()}`}};et=a([tt("0iiTFqnPTyC5E64Nz3i2Fg")],et);var{regClass:at}=Laya,it=class extends Laya.Script{onAwake(){this.owner.ok.onClick=()=>{let t=Z.data.player,e=5*(t.forget+1);t.level<e?F.tip(B.buzu):(t.level-=e,t.forget+=1,F.tip("遗忘技能".toStr()+`·<font color='${R.xinximoban.skill}'>${this.data.name.toStr()}</font>`,!1),t.skills.splice(t.skills.indexOf(this.data.id),1),Ft.instance.update_player(),Ft.instance.update_skill(),this.owner.close(),Z.saveGame())},this.owner.no.onClick=()=>{this.owner.close()}}show(t,e){e?(this.owner.ok.visible=!0,this.owner.no.x=420):(this.owner.ok.visible=!1,this.owner.no.x=285),this.owner.parent.setChildIndex(this.owner,this.owner.parent.numChildren-1),this.data=t;let a=5*(Z.data.player.forget+1);this.owner.ok.tip.text="需要等级>".toStr()+a,this.owner.Label.text=`<font color='#ffe900' size=40>${t.name.toStr()}</font>\n\n${t.description.toStr()}`,this.owner.open()}};it=a([at("TeBj67zKTwymfmLpcRf_Aw")],it);var{regClass:st}=Laya,ot=class extends Laya.Script{onStart(){let t=this.owner;t.color="#FF4900",t.onClick=()=>{this.data&&Ft.instance.SkillTip.getComponent(it).show(this.data,this.isForget)}}show(t,e=!1){var a,i;this.isForget=e,this.data=S.table.Tbskill.get(t),!t||this.data?this.owner.title.text=null!=(i=null==(a=this.data)?void 0:a.name.toStr())?i:"":console.error(`技能${t}不存在!`)}};ot=a([st("vdLRBex-Roidhl5M9zhxuA")],ot);var{regClass:lt}=Laya,ht=class extends Laya.Script{onAwake(){ht.instance=this,this.owner.no.onClick=()=>{Ft.instance.update_skill(),Ft.instance.update_player(),this.owner.close(),Z.saveGame()},this.owner.ok.onClick=()=>{S.table.Tbachieve.getDataList().forEach((t=>{1===Z.data.game.achieves[t.id]&&rt.reward(t)})),Ft.instance.Tujian.getComponent(ht).show(!1)}}show(t=!0){var e,a;t&&this.owner.open();let i="",s=0,o=S.table.Tbachieve.getDataList();o.forEach((t=>{Z.data.game.achieves[t.id]>0&&s++})),i+="成就完成率:".toStr()+z(s/o.length),s=0;let l=S.table.Tbrole.getDataList();l.forEach((t=>{Z.data.game.roles[t.id]&&s++})),i+="\n"+"图鉴完成率:".toStr()+z(s/l.length),this.owner.Label.text=i;let h=this.owner.getChildByName("list_chengjiu");h.scrollBar.autoHide=!0,null==(e=h.renderHandler)||e.clear(),h.array=o,h.renderHandler=Laya.Handler.create(this,((t,e)=>{t.getComponent(rt).show(e+1)}),null,!1);let n=this.owner.getChildByName("list_tujian");n.scrollBar.autoHide=!0,null==(a=n.renderHandler)||a.clear(),n.array=l,n.renderHandler=Laya.Handler.create(this,((t,e)=>{t.getComponent(et).show(l[e])}),null,!1),this.show_role(S.table.Tbrole.get("h1"))}show_role(t){var e,a;this.owner.getChildByName("Name").text=Ft.getRoleName(t);let i=!Z.data.game.roles[t.id],s="";t.rare<4&&i&&(s="击杀解锁".toStr()+`\n(${Z.data.game.kills[t.id]}/${$[t.rare-1]})`),Ft.isBoss(t)&&0===Z.data.game.rewards.boss&&(s="无法拟态需成就解锁".toStr()),this.owner.getChildByName("Lock").text=s,this.owner.getChildByName("Chengzhang").text=`${"攻击成长:".toStr()}<font color='#78D658'>${t.attackRate}</font>\n${"防御成长:".toStr()}<font color='#78D658'>${t.defenceRate}</font>\n${"血量成长:".toStr()}<font color='#78D658'>${t.healthRate}</font>`,this.owner.getChildByName("Jiacheng").text=`${"攻击:".toStr()}<font color='#ffffff'>${O(t.attackAdd)}</font>\n${"防御:".toStr()}<font color='#ffffff'>${O(t.defenceAdd)}</font>\n${"血量:".toStr()}<font color='#ffffff'>${O(t.healthAdd)}</font>`;let o=this.owner.getChildByName("list_shuxing");var l=t.relations,h=t.race*t.remain*T;let n=[];for(let a in t.relations){var r=H((null!=(e=l[a])?e:0)*h);const t=a;r>0&&n.push(`${N[t].toStr()}:<font color='#ffffff'>${i?"???":O(r)}</font>`)}o.dataSource=n;let d=this.owner.getChildByName("list_skill");d.scrollBar.autoHide=!0,null==(a=d.renderHandler)||a.clear(),d.dataSource=t.skills,d.renderHandler=Laya.Handler.create(this,((e,a)=>{e.getComponent(ot).show(t.skills[a])}),null,!1)}};ht=a([lt("qiBKDC1JT7uCFMZAu-ASTg")],ht);var{regClass:nt}=Laya,rt=class extends Laya.Script{onAwake(){this.owner.onClick=()=>{rt.reward(this.data),Ft.instance.Tujian.getComponent(ht).show(!1)}}show(t){let e=S.table.Tbachieve.get(t);this.data=e;let a,i=this.owner.getChildByName("Frame"),s=i.getChildByName("Title"),o=i.getChildByName("Tip"),l=rt.getCount(e),h=e.count;l<h?(a=`(${l}/${h})`,o.color="#6AB548"):(a="完成".toStr(),o.color="#c58237"),o.text=a,s.text=e.description.toStr(),this.owner.tip.text=e.rewardStr.toStr();let n=Z.data.game.achieves[t];1===n?(this.owner.title.text="领取奖励".toStr(),this.owner.active=!0):(this.owner.title.text=2===n?"已领取".toStr():"未完成".toStr(),this.owner.active=!1)}static reward(t){if(Z.data.game.achieves[t.id]=2,"random"===t.rewardType){var e=S.table.Tbrole.getDataList().filter((t=>!Z.data.game.roles[t.id]));if(e.length>0){var a=e[Math.floor(Math.random()*e.length)];Ft.unlockRole(a.id)}else F.tip("所有图鉴已解锁")}else F.tip(t.rewardStr),Z.data.game.rewards[t.rewardType]++}static getCount(t){return"map"===t.type?Z.data.player.maxScene:"rebirth"===t.type?Z.data.game.rebirth:"kill"===t.type?Z.data.game.kills[t.target]:0}static addCount(t,e){let a=S.table.Tbachieve.getDataList(),i=Z.data.game.achieves;if(e){Z.data.game.kills[e]++;var s=S.table.Tbrole.get(e);s.rare<4&&!Z.data.game.roles[e]&&Z.data.game.kills[e]>=$[s.rare-1]&&Ft.unlockRole(e)}a.forEach((a=>{i[a.id]>0||a.type===t&&("map"===t&&a.count<=Z.data.player.maxScene||"rebirth"===t&&a.count<=Z.data.game.rebirth||e&&"kill"===t&&a.target===e&&a.count<=Z.data.game.kills[e])&&(i[a.id]=1,F.show("达成：".toStr()+`${a.description.toStr()}`,null,null,!1))}))}};rt=a([nt("3TX1KPIcRt2UJAt_EmF5Pg")],rt);var{regClass:dt,property:ct}=Laya,ut=class extends Laya.Script{onAwake(){this.bg||(this.bg=this.owner.addChild(new Laya.Sprite),this.bar=this.bg.addChild(new Laya.Sprite),this.bg.size(160,16),this.bg.pos(35,88),this.bar.size(158,14),this.bar.pos(1,1),this.bg.graphics.drawRect(0,0,1,1,"#313c3c","#ffffff").percent=!0,this.drawRect=this.bar.graphics.drawRect(0,0,1,1,"#ff0000"),this.drawRect.percent=!0),this.originalWidth=this.bar.width,this.setValue(0,!1)}setValue(t,e=!0){const a=this.originalWidth*Math.min(Math.max(t,0),1);e?Laya.Tween.to(this.bar,{width:a},200):this.bar.width=a}setColor(t){this.drawRect&&(this.drawRect.fillColor=t)}};a([ct({type:Laya.Sprite})],ut.prototype,"bg",2),a([ct({type:Laya.Sprite})],ut.prototype,"bar",2),ut=a([dt("uO32Pu0TShWyXIQxB9XMyw")],ut);var gt=class{static getList(t){return"player"==t?this.playerBuff:this.enemyBuff}static getBuff(t,e){var a;return null!=(a=this.getList(t.camp).find((t=>t.data.id===e.id)))?a:null}static createBuff(t,e){let a;if(3===e.type)a=new pt(e,t);else a=new ft(e,t);return this.getList(t.camp).push(a),a}static addBuff(t,e){if(void 0===e.buffRound)return;let a=this.getBuff(t,e);if(a&&a.reapply())return;if(a=this.createBuff(t,e),null==a)return;if(a.apply(),0===e.buffRound)return void this.tempBuff.push(a);if(-1===e.buffRound)return void this.permanentBuff.push(a);let i=t.camp+e.name;this.buffs.has(i)||this.buffs.set(i,a)}static removeBuffByOwner(t,e){let a=this.getList(t.camp);for(let t=a.length-1;t>=0;t--)if(a[t]===e){a.splice(t,1);break}}static is(t,e){var a,i;return null!=(i=null==(a=this.getList(t.camp))?void 0:a.some((t=>t.type===e)))&&i}static clearTemp(){0!==this.tempBuff.length&&(this.tempBuff.forEach((t=>t.remove())),this.tempBuff.length=0)}static clearByRevive(t){this.clearTemp();const e=[];for(const[a,i]of this.buffs)i.owner===t&&(i.remove(),e.push(a));e.forEach((t=>this.buffs.delete(t)))}static clear(){this.playerBuff.length=0,this.enemyBuff.length=0,this.tempBuff.length=0,this.permanentBuff.length=0,this.buffs.clear()}static updateBuffs(t){if(this.buffs.has(t)){this.buffs.get(t).updateBuffs()}}};gt.playerBuff=[],gt.enemyBuff=[],gt.tempBuff=[],gt.permanentBuff=[],gt.buffs=new Map;var ft=class{constructor(t,e){this.data=t,this.owner=e,this.name=t.name,this.duration=t.buffRound,this.type=t.type,console.log(`${this.name} created with duration: ${this.duration} `)}apply(){}remove(){console.log(`${this.name} removed from ${this.owner.camp} `),gt.removeBuffByOwner(this.owner,this);const t=this.owner.camp+this.name;gt.buffs.has(t)&&gt.buffs.get(t)===this&&gt.buffs.delete(t)}reapply(){return this.duration=this.data.buffRound,!0}updateBuffs(){this.duration--,console.log(`${this.name} remaining duration: ${this.duration} `),this.duration<=0&&this.remove()}},pt=class extends ft{constructor(){super(...arguments),this.attack=0,this.defence=0}apply(){if(console.log(`Applying ${this.name} to ${this.owner.camp} `),this.data.values.has("1")){let t=Number(this.data.values.get("1"));this.attack=H(t*this.owner.attack.value),console.log(`${this.owner.camp} gains + ${this.attack} attack.`),this.owner.attack.add(this.attack)}if(this.data.values.has("2")){let t=Number(this.data.values.get("2"));this.defence=H(t*this.owner.defence.value),console.log(`${this.owner.camp} gains + ${this.defence} defence.`),this.owner.defence.add(this.defence)}}remove(){console.log(`Removing ${this.name} from ${this.owner.camp} `),0!=this.attack&&(this.owner.attack.add(-this.attack),console.log(`${this.owner.camp} loses ${this.attack} attack.`)),0!=this.defence&&(this.owner.defence.add(-this.defence),console.log(`${this.owner.camp} loses ${this.defence} defence.`)),super.remove()}reapply(){if(this.data.buffRound>0)return!1;if(super.reapply(),this.data.values.has("1")){let t=this.attack,e=Number(this.data.values.get("1"));this.attack=H(e*this.owner.attack.value)+t,console.log(`${this.owner.camp} gains + ${this.attack} attack.`),this.owner.attack.add(-t),this.owner.attack.add(this.attack)}if(this.data.values.has("2")){let t=this.defence,e=Number(this.data.values.get("2"));this.defence=H(e*this.owner.defence.value)+t,console.log(`${this.owner.camp} gains + ${this.defence} defence.`),this.owner.defence.add(-t),this.owner.defence.add(this.defence)}return!0}},{regClass:vt}=Laya,mt=class extends Laya.Script{onAwake(){this.animator=this.owner.getComponent(Laya.Animator2D),this.original_x=this.owner.x,this.original_y=this.owner.y,this.hpBar=this.owner.getComponent(ut),this.owner.onClick=()=>{Ft.instance.Enemy.getComponent(mt).show(this.data.id,this.level),Ft.instance.show_battle(this.data.id,this.level,!1)}}init(t,e,a){let i=S.table.Tbrole.get(e);this.data=i,this.level=a,this.owner.title.text=Ft.getRoleName(i),this.owner.image.getChildByName("Level").text=`Lv.${a}`;let s=G(a),o=H(s.attack*i.attackRate*t),l=H(s.defence*i.defenceRate*t),h=H(s.health*i.healthRate*t),n=Ft.getPower(o,l,h);this.owner.image.getChildByName("Tip").text="战力:".toStr()+`${O(n)}`}show(t,e,a){let i=S.table.Tbrole.get(t);this.data=i,this.level=e,this.owner.title.text=Ft.getRoleName(i),this.owner.image.getChildByName("Level").text=`Lv.${e}`,a&&(this.owner.image.getChildByName("Tip").text="战力:".toStr()+`${O(a)}`)}show_skin(t){t?(this.owner.image.skin="resources/image/boss.png",this.owner.image.color="#9A1919"):(this.owner.image.skin="resources/image/enemy.png",this.owner.image.color="#666b6f")}event_damage(){Laya.SoundManager.playSound(S.sounds.get("att")),this.role.attackAction()}event_end(){gt.clearTemp(),Ft.instance.battle.round(this.role.target)}play_anim(t){this.owner.parent.setChildIndex(this.owner,this.owner.parent.numChildren-1),this.animator.play(t,0,0)}};mt=a([vt("GkQGXdX0S-eACaQKWc1P0w")],mt);var yt=class t{static getDamageLabel(){let t=this.damageLabelPool.pop();return t||(t=new Laya.Label,t.bold=!0,t.fontSize=32,t.anchorX=.5,t.width=300,t.align="center"),t.visible=!0,t.alpha=1,t.scale(1,1),Ft.instance.Damages.addChild(t),t}static recycleDamageLabel(t){t.removeSelf(),t.visible=!1,this.damageLabelPool.push(t)}static show(e){const a=e.y;e.alpha=0,Laya.Tween.to(e,{alpha:1},200),Laya.Tween.to(e,{y:a-50,scale:1.5},500,null,Laya.Handler.create(this,(()=>{Laya.Tween.to(e,{y:a-100,scale:.5,alpha:0},500,null,Laya.Handler.create(this,(()=>{t.recycleDamageLabel(e)})))})))}static showDamage(t,e){const a=this.getDamageLabel();a.text=`-${O(-t)}`,a.color="#ee123d",a.pos(e.original_x,e.original_y-80),this.show(a)}static showHeal(t,e){const a=this.getDamageLabel();a.text=`+${O(t)}`,a.color="#12ee64",a.pos(e.original_x,e.original_y);const i=a.x;a.x=i+(100*Math.random()-50),this.show(a)}static showDodge(e){const a=this.getDamageLabel();a.text="闪避".toStr(),a.color="#12eee0",a.pos(e.original_x,e.original_y);const i=a.x,s=a.y;a.x=i+(100*Math.random()-50),a.y=s,a.alpha=0,Laya.Tween.to(a,{alpha:1},200,null,null,0),Laya.Tween.to(a,{alpha:.8},100,null,null,200),Laya.Tween.to(a,{alpha:1},100,null,null,300),Laya.Tween.to(a,{y:s-30,scale:1.2},150,null,Laya.Handler.create(this,(()=>{Laya.Tween.to(a,{y:s-15,scale:1},150,null,Laya.Handler.create(this,(()=>{Laya.Tween.to(a,{y:s-10,scale:.8,alpha:0},300,null,Laya.Handler.create(this,(()=>{t.recycleDamageLabel(a)})))})))})),400)}static showBlock(e){const a=this.getDamageLabel();a.text="格挡".toStr(),a.color="#eee712",a.pos(e.original_x,e.original_y);const i=a.x,s=a.y;a.x=i+(100*Math.random()-50),a.y=s,a.alpha=0,Laya.Tween.to(a,{alpha:1},300),Laya.Tween.to(a,{y:s-80,scale:1.2},500,null,Laya.Handler.create(this,(()=>{Laya.Tween.to(a,{y:s-100,scale:1,alpha:0},500,null,Laya.Handler.create(this,(()=>{t.recycleDamageLabel(a)})))})))}};yt.damageLabelPool=[];var wt=yt,bt=class{constructor(){this._flag=0,this._items=[]}add(t,e,a){const i=this._items,s=i.findIndex(((a,s)=>a===t&&i[s+1]===e));-1!==s?(i[s+2]=a,i[s+3]=1):i.push(t,e,a,1)}once(t,e,a){const i=this._items,s=i.findIndex(((a,s)=>a===t&&i[s+1]===e));-1!==s?(i[s+2]=a,i[s+3]=2):i.push(t,e,a,2)}remove(t,e){const a=this._items,i=a.findIndex(((i,s)=>i===t&&a[s+1]===e));-1!==i&&(0!==this._flag?(a[i+3]=0,this._flag=2):a.splice(i,4))}clear(){if(0!==this._flag){for(let t=3;t<this._items.length;t+=4)this._items[t]=0;this._flag=2}else this._items.length=0}clearForTarget(t){if(!t)return;const e=this._items;if(0!==this._flag){for(let a=1;a<e.length;a+=4)e[a]===t&&(e[a+3]=0);this._flag=2}else for(let a=e.length-4;a>=0;a-=4)e[a+1]===t&&e.splice(a,4)}get count(){return this._items.length/4}invokeAsync(...t){return i(this,null,(function*(){if(0!==this._flag)return;this._flag=1;const e=this._items,a=[];for(let i=0;i<e.length;i+=4){if(0===e[i+3])continue;const s=e[i],o=e[i+1],l=e[i+2];try{const e=l?s.call(o,...l,...t):s.call(o,...t);e instanceof Promise&&a.push(e)}catch(t){console.error(t)}2===e[i+3]&&(e[i+3]=0,this._flag=2)}if(a.length>0&&(yield Promise.all(a)),2===this._flag)for(let t=0;t<e.length;)0===e[t+3]?e.splice(t,4):t+=4;this._flag=0}))}},_t=class{constructor(){this._events={}}hasListener(t){const e=this._events[t];return!!e&&e.count>0}on(t,e,a,i){this._events[t]||(this._events[t]=new bt),this._events[t].add(a,e,i)}once(t,e,a,i){this._events[t]||(this._events[t]=new bt),this._events[t].once(a,e,i)}off(t,e,a){const i=this._events[t];i&&i.remove(a,e)}offAll(t){t?delete this._events[t]:this._events={}}dispatchAsync(t,...e){return i(this,null,(function*(){const a=this._events[t];a&&(yield a.invokeAsync(...e))}))}};var St=class{constructor(t){this.data=t}check(t){return Math.random()<=this.data.rate}},kt=class extends St{check(t){return this.data.condition?!!(this.data.condition.has("hp")&&t.health.per<=this.data.condition.get("hp"))&&super.check(t):super.check(t)}},Lt=class{static getList(t){return"player"==t?this.playerSkills:this.enemySkills}static createSkill(t,e){let a;switch(e.type){case 1:a=new Ct(e,t);break;case 2:a=new Mt(e,t);break;case 4:a=new Tt(e,t);break;case 5:a=new $t(e,t);break;case 12:a=new Rt(e,t);break;case 10:a=new Et(e,t);break;case 13:a=new Bt(e,t);break;default:a=new xt(e,t)}return this.getList(t.camp).push(a),a}static clear(){this.playerSkills.length=0,this.enemySkills.length=0}};Lt.playerSkills=[],Lt.enemySkills=[];var xt=class{constructor(t,e){this.data=t,this.owner=e,this.name=t.name,this.condition=function(t){return t.condition&&t.condition.has("hp")?new kt(t):new St(t)}(t),e.on(t.trigger.toString(),this,this.onTrigger)}onTrigger(){gt.updateBuffs(this.getTarget().camp+this.data.name),this.checkCondition()&&this.trigger()}trigger(){void 0!==this.data.buffRound&&gt.addBuff(this.getTarget(),this.data)}checkCondition(){if(this.condition.check(this.owner)){let t;return"player"===this.owner.camp?t=B.zhandou.jineng1.toStr().replace("{p}",R.xinximoban.player).replace("{s}",R.xinximoban.skill):(t=B.zhandou.jineng2.toStr().replace("{e}",R.xinximoban.enemy).replace("{s}",R.xinximoban.skill),t=t.replace("^",Ft.getRoleName(this.owner.view.data))),t=t.replace("*",this.data.name.toStr()),t=t.replace("&",this.data.effectStr.toStr()),j.log(t,!1),!0}return!1}getTarget(){return 0==this.data.target?this.owner:this.owner.target}ban(){j.log(`${Ft.getRoleName(this.owner.view.data)} 禁用技能: ${this.name}`),this.owner.off(this.data.trigger.toString(),this,this.onTrigger)}},Ct=class extends xt{trigger(){let t=0,e=this.getTarget();if(this.data.values.has("1")){t=H(Number(this.data.values.get("1"))*this.owner.attack.value),console.log(`${e.camp} health + ${t}`),e.takeDamage(this.owner,e,t)}if(this.data.values.has("2")){t=H(Number(this.data.values.get("2"))*this.owner.damage),console.log(`${e.camp} health + ${t}`),e.takeDamage(this.owner,e,t)}}},Mt=class extends xt{constructor(t,e){super(t,e),this.count=0,t.values.has("1")&&(this.count=Number(t.values.get("1")))}trigger(){if(this.count<1)return void j.log("可惜，复活次数已用尽！");this.count--;let t=this.getTarget();t.health.reset(),gt.clearByRevive(t),console.log(`${t.camp} revive!`)}},Tt=class extends xt{trigger(){let t=this.getTarget(),e=t.attack.value;t.attack.init(t.defence.value),t.defence.init(e)}},$t=class extends xt{trigger(){let t=0,e=this.getTarget();this.data.values.has("1")&&(t=Number(this.data.values.get("1")),e.hurt+=t,console.log(`${e.camp} hurt + ${t}`)),this.data.values.has("2")&&(t=Number(this.data.values.get("2")),e.bear+=t,console.log(`${e.camp} bear + ${t}`))}},Et=class extends xt{trigger(){let t=0,e=this.getTarget();if(this.data.values.has("1")){t=H(this.data.values.get("1"));let a=Lt.getList(e.camp);this.getRandomSkills(a,t).forEach((t=>{t.ban(),a.splice(a.indexOf(t),1)}))}}getRandomSkills(t,e){const a=[...t].sort((()=>.5-Math.random()));return a.slice(0,Math.min(e,a.length))}},Rt=class t extends xt{trigger(){let e=0,a=this.getTarget();if(this.data.values.has("1")){e=Number(this.data.values.get("1"));let i=S.table.Tbskill.getDataList(),s=Lt.getList(a.camp);t.getNewSkills(i,s,e).forEach((t=>{Lt.createSkill(a,t),j.log(`${Ft.getRoleName(this.owner.view.data)} 获得技能: ${t.name}`)}))}}static getNewSkills(t,e,a){const i=new Set(e.map((t=>t.data.id))),s=t.filter((t=>!i.has(t.id)));return this.getRandomSkills(s,a)}static getRandomSkills(t,e){const a=[...t].sort((()=>.5-Math.random()));return a.slice(0,Math.min(e,a.length))}},Bt=class extends xt{trigger(){let t=0,e=this.getTarget();if("player"!==e.camp){if(this.data.values.has("1")){t=Number(this.data.values.get("1"));let a=S.table.Tbskill.getDataList(),i=Lt.getList(e.camp);Rt.getNewSkills(a,i,t).forEach((t=>{Lt.createSkill(e,t),j.log(`${Ft.getRoleName(this.owner.view.data)} 获得技能: ${t.name}`)}))}if(this.data.values.has("2")){let a=Z.data.player.curScene;console.log(`当前层数: ${a}`),t=a-100,t=Math.max(1,t);let i=S.table.Tbskill.getDataList(),s=Lt.getList(e.camp);Rt.getNewSkills(i,s,t).forEach((t=>{Lt.createSkill(e,t),j.log(`${Ft.getRoleName(this.owner.view.data)} 获得技能: ${t.name}`)}))}}}},Nt=class extends _t{constructor(t,e){super(),this.view=e,this.hurt=0,this.bear=0,this.isBoss=!1,this.damage=0,this.camp=t,this.view.role=this,this.health=new At(((t,a)=>{var i,s;console.log(this.camp," health remain:",t,a),null==(i=e.hpBar)||i.setValue(a),this.isBoss&&(null==(s=Ft.instance.battle.bossHp)||s.setValue(a)),j.log(`${Ft.getRoleName(this.view.data)} `+"当前生命值:".toStr()+O(t))})),this.attack=new Dt(((t,e)=>{j.log(`${Ft.getRoleName(this.view.data)} `+"当前攻击力:".toStr()+O(t))})),this.defence=new Dt(((t,e)=>{j.log(`${Ft.getRoleName(this.view.data)} `+"当前防御力:".toStr()+O(t))}))}clear(){this.offAll()}init(t,e,a,i,s=!1){this.isBoss=s,this.attack.init(t),this.defence.init(e),this.health.init(a);for(let t of i){let e=S.table.Tbskill.get(t);e?(console.log(`Skill ${e.name} created!`),Lt.createSkill(this,e)):console.log(`Skill ${t} not found!`)}}round(){return i(this,null,(function*(){gt.is(this,9)?Ft.instance.battle.round(this.target):(this.hurt=0,this.damage=0,this.target.bear=0,yield this.dispatchAsync(3..toString()),yield this.dispatchAsync(4..toString()),yield this.target.dispatchAsync(7..toString()),yield this.dispatchAsync(5..toString()),yield this.target.dispatchAsync(8..toString()),gt.is(this,8)?Ft.instance.battle.round(this.target):this.view.play_anim(this.camp))}))}attackAction(){Laya.SoundManager.playSound(S.sounds.get("att"+H(3*Math.random())));let t=this.target,e=!1;if(gt.is(t,6)&&(console.log(`${t.camp} miss!`),gt.is(this,7)?console.log(`${this.camp} hit!`):e=!0),gt.is(this,11)&&(console.log(`${this.camp} replace!`),t=t.target),this.damage=H(t.getDamage(this.attack.value)*(1+this.hurt)*(1+t.bear)),this.damage=Math.max(0,this.damage),e||0===this.damage)if(Laya.SoundManager.playSound(S.sounds.get("def"+H(3*Math.random()))),e){let e;wt.showDodge(t.view),"player"===t.camp?e=B.zhandou.shanbi1.toStr().replace("{p}",R.xinximoban.player):(e=B.zhandou.shanbi2.toStr().replace("{e}",R.xinximoban.enemy),e=e.replace("*",Ft.getRoleName(t.view.data))),j.log(e,!1)}else{let e;wt.showBlock(t.view),"player"===t.camp?e=B.zhandou.gedang1.toStr().replace("{p}",R.xinximoban.player):(e=B.zhandou.gedang2.toStr().replace("{e}",R.xinximoban.enemy),e=e.replace("*",Ft.getRoleName(t.view.data))),j.log(e,!1)}else console.log(`${this.camp} attacks ${t.camp}! damage: ${this.damage}`),t.takeDamage(this,t,-this.damage);this.dispatchAsync(6..toString()),e||t.dispatchAsync(9..toString())}getDamage(t){return Math.max(0,t-this.defence.value)}takeDamage(t,e,a){if(0!==a){if(a>0){let e;wt.showHeal(a,this.view),"player"===t.camp?e=B.zhandou.huifu1.toStr().replace("{p}",R.xinximoban.player).replace("{s}",R.xinximoban.huixue):(e=B.zhandou.huifu2.toStr().replace("{e}",R.xinximoban.enemy).replace("{s}",R.xinximoban.huixue),e=e.replace("*",Ft.getRoleName(t.view.data))),e=e.replace("&",O(a)),j.log(e,!1)}if(a<0){let i;wt.showDamage(a,this.view),"player"===t.camp?(i=B.zhandou.huihe1.toStr().replace("{p}",R.xinximoban.player).replace("{s}",R.xinximoban.shanghai),i=i.replace("*",Ft.getRoleName(e.view.data))):(i=B.zhandou.huihe2.toStr().replace("{e}",R.xinximoban.enemy).replace("{s}",R.xinximoban.shanghai),i=i.replace("*",Ft.getRoleName(t.view.data))),i=i.replace("&",O(Math.abs(a))),j.log(i,!1)}this.health.add(a)}}isAlive(){return this.health.value>0}},Dt=class{constructor(t){this.cur=0,this.max=0,this.callback=t}reset(){this.value=this.max}init(t){this.max=t,this.reset()}set value(t){this.cur=t,this.callback&&this.callback(this.cur,this.max)}get value(){return this.cur}add(t){this.value+=t}getMax(){return this.max}},At=class extends Dt{set value(t){this.cur=t,this.cur<0&&(this.cur=0),this.cur>this.max&&(this.cur=this.max),this.callback&&this.callback(this.cur,this.per=this.cur/this.max)}get value(){return this.cur}get original(){return this.max}addMax(t){this.max+=t,this.value+=t}},jt=class{constructor(){this.round_count=0,this.bossHp=Ft.instance.Battle.getComponent(ut),this.player=new Nt("player",Ft.instance.Player.getComponent(mt)),this.enemy=new Nt("enemy",Ft.instance.Enemy.getComponent(mt)),this.player.target=this.enemy,this.enemy.target=this.player}init(t,e,a){let i=Z.data.player,s=S.table.Tbrole.get(i.id),o=G(i.level),l=S.table.Tbrebirth.get(Z.data.game.rebirth),h=Ft.getAddition(),n=Ft.getAttack(s,o,l,h),r=Ft.getDefence(s,o,l,h),d=Ft.getHealth(s,o,l,h);this.player.init(n,r,d,s.skills.concat(i.skills));let c=S.table.Tbmap_level.get(i.curScene);s=S.table.Tbrole.get(t),o=G(e),n=H(o.attack*s.attackRate*c.attackRate),r=H(o.defence*s.defenceRate*c.defenceRate),d=H(o.health*s.healthRate*c.healthRate),a&&(n=H(n*k),r=H(r*L),d=H(d*x)),Ft.instance.Enemy.getComponent(mt).show_skin(a),this.bossHp.bg.visible=a,this.enemy.init(n,r,d,s.skills,a)}start(){return i(this,null,(function*(){j.log(B.zhandou.kaishi);let t=S.sounds.get("battle_bgm");Laya.SoundManager._bgMusic!==t&&Laya.SoundManager.playMusic(t),this.player.health.reset(),this.enemy.health.reset(),this.escape=!1,this.draw=!1,this.round_count=0;let e=this.player,a=this.enemy;var i;e.dispatchAsync(1..toString()),a.dispatchAsync(1..toString()),e.dispatchAsync(2..toString()),a.dispatchAsync(2..toString()),yield(i=200,new Promise((t=>setTimeout(t,i)))),this.round(e)}))}round(t){return i(this,null,(function*(){"player"===t.camp&&(this.round_count++,j.log("第*回合".toStr().replace("*",this.round_count.toString())),this.round_count>100&&(this.round_count=0,this.draw=!0)),this.escape||this.draw||!t.isAlive()||!t.target.isAlive()?(Lt.clear(),gt.clear(),this.player.clear(),this.enemy.clear(),Ft.instance.deal_battle_result()):yield t.round()}))}victory(){let t=this.enemy.view.data,e=this.enemy.view.level,a=this.enemy.isBoss;rt.addCount("kill",t.id);let i=Z.data.player;i.scenes[i.curScene].count++;let s=G(e);Ft.addExp(s.exp*t.expDead),Ft.addValue(t),Ft.instance.learn(t),a&&(F.tip("闯关成功！"),i.scenes[i.curScene].pass=1,i.maxScene=i.curScene,rt.addCount("map"),Ft.instance.update_map()),Ft.instance.update_player()}},Ht=class{static saveLeaveTime(){localStorage.setItem("lastLeaveTime",Date.now().toString())}static checkOfflineTime(){const t=parseInt(localStorage.getItem("lastLeaveTime"))||Date.now(),e=Date.now();return Math.floor((e-t)/1e3)}},{regClass:zt}=Laya,Ot=class extends Laya.Script{show(){let t=Z.data.player;this.refined=this.refining(),this.owner.getChildByName("list_shuxing").dataSource=Object.keys(t.relation).map((e=>{const a=e;let i=this.refined[e]-t.relation[e],s="";return i>0?s=`<font color=green>+${O(i)}</font>`:i<0&&(s=`<font size=18 color=red>-${O(Math.abs(i))}</font>`),`${N[a].toStr()}:<font color='#AFAFAF'>${O(t.relation[e])}</font> ${s}`})),this.owner.open()}onAwake(){this.owner.Label.text="是否消耗*级进行淬炼，淬炼后生物属性向当前物种靠拢。".toStr().replace("*",Ot.level.toString()),this.owner.ok.onClick=()=>{let t=Z.data.player;t.level-=Ot.level,t.relation=this.refined,Ft.instance.update_player(),this.owner.close(),F.tip(B.cuilian.toStr().replace("^",R.xinximoban.huixue),!1),Laya.SoundManager.playSound(S.sounds.get("upgrade")),Z.saveGame()},this.owner.no.onClick=()=>{this.owner.close()}}refining(){let t=Z.data.player,e=S.table.Tbrole.get(t.id);var a=t.relation,i=e.relations,s=Object.keys(a),o=0;s.forEach((t=>{o+=a[t]}));var l={};return s.forEach((t=>{var s,h=0,n=0,r=0,d=a[t],c=null!=(s=i[t])?s:0;d/o-3*c>0&&(h=-.1),d/o-.9*c<0&&(h=.1),d-c*e.race*2<0&&(n=.1),0==c&&(r=-.1),l[t]=H((h+n+r)*d)+d})),l}};Ot.level=10,Ot=a([zt("LOdO6nxVSaW9LKPr5KibAQ")],Ot);var Pt=class extends Laya.Scene{},{regClass:qt}=Laya,Ft=class extends Pt{show(){this.getChildByName("Top").visible=!0,this.getChildByName("Middle").visible=!0,this.getChildByName("Bottom").visible=!0}onAwake(){Ft.instance=this,this.battle=new jt,this.list_guyou.scrollBar.autoHide=!0,this.list_xuexi.scrollBar.autoHide=!0,this.show_map(),this.update_player(),this.update_skill(),this.btn_login.onClick=()=>{Laya.Scene.open("Login.ls")},this.btn_jineng.onClick=()=>{this.img_jineng.visible=!0,this.img_shuxing.visible=!1},this.btn_shuxing.onClick=()=>{this.img_jineng.visible=!1,this.img_shuxing.visible=!0},this.btn_sousuo.onClick=()=>{this.update_map()},this.btn_boss.onClick=()=>{let t=Z.data.player.scenes[Z.data.player.curScene];this.Enemy.getComponent(mt).show(t.boss,t.level),this.show_battle(t.boss,t.level,!0)},this.btn_shenru.onClick=()=>{Z.data.player.curScene>Z.data.player.maxScene||(Z.data.player.curScene++,j.log(B.shenru.toStr().replace("*",P(Z.data.player.curScene)),!1),this.update_map(),Z.saveGame())},j.log(B.shenru.toStr().replace("*",P(Z.data.player.curScene)),!1),this.btn_fanhui.onClick=()=>{Z.data.player.curScene=Math.max(Z.data.player.curScene-1,1),j.log(B.shenru.toStr().replace("*",P(Z.data.player.curScene)),!1),this.update_map(),Z.saveGame()},this.btn_taopao.onClick=()=>{let t=Z.data.setting.auto;this.battle.escape=!0,Z.data.setting.auto=!1,this.update_auto(),t&&Z.saveGame()},this.btn_tujian.onClick=()=>{this.Tujian.getComponent(ht).show()},this.btn_jinhua.onClick=()=>{let t=Z.data.player,e=S.table.Tbrole.get(t.id),a=E[Math.min(E.length-1,e.rare)];Z.data.player.level>a?this.Jinhua.getComponent(V).show():F.tip(B.buzu)},this.btn_cuilian.onClick=()=>{Z.data.player.level>Ot.level?this.Cuilian.getComponent(Ot).show():F.tip(B.buzu)},this.btn_zhuansheng.onClick=()=>{let t=Z.data.game.rebirth;if(t>999)return void F.tip("<font color='#FF0000'>已达到最大转生数</font>");let e=S.table.Tbrebirth.get(0===t?1:t);if(Z.data.player.level<=e.need)return void F.tip(B.buzu);let a=10;t>99&&(a=1),t>199&&(a=.1),F.show("是否进行转生，等级、种族重置为初始状态，全属性永久额外增加".toStr()+`${a}%`,(()=>{if(Z.data.game.rebirth++,1==Z.data.game.rebirth&&F.show("解锁：自动战斗".toStr(),null,null,!1),2==Z.data.game.rebirth&&F.show("解锁：定向拟态".toStr(),null,null,!1),3==Z.data.game.rebirth){var t=S.table.Tbskill.get("jiexi");F.show("习得：".toStr()+`${t.name.toStr()}`,null,null,!1)}Z.data.player=Z.reset(),F.tip(B.zhuansheng.toStr().replace("^",R.xinximoban.huixue),!1),rt.addCount("rebirth"),Laya.SoundManager.playSound(S.sounds.get("upgrade")),this.show_map(),this.update_player(),this.update_skill(),Z.saveGame()}))},this.List.array=j.get(),j.instance.callback=()=>{this.List.refresh(),this.List.scrollTo(this.List.array.length-1)},this.List.scrollBar.autoHide=!0,this.btn_zidong.onClick=()=>{Z.data.setting.auto=!Z.data.setting.auto,Z.data.setting.auto?this.auto_fight():this.battle.escape=!0,this.update_auto()},this.update_auto(),Ht.saveLeaveTime(),document.addEventListener("visibilitychange",(()=>{if("hidden"===document.visibilityState)this.hasCalculatedOffline=!1,Ht.saveLeaveTime();else if("visible"===document.visibilityState){if(this.hasCalculatedOffline)return;this.hasCalculatedOffline=!0;const t=Ht.checkOfflineTime();let e=Math.min(3600,t),a=G(Z.data.player.level),i=Math.floor(e/10*a.exp);Ft.addExp(i),F.show("你离线了 * 秒（最多一小时），获得了 ^ 经验！".toStr().replace("*",e.toString()).replace("^",i.toString()),null,null,!1),this.update_player(),Z.saveGame()}}))}update_auto(){this.btn_zidong.title.text=(Z.data.setting.auto?"停止":"自动战斗").toStr()}auto_fight(){let t=S.table.Tbmap_level.get(Z.data.player.curScene),e=Ft.getMonsterByScene(t),a=Ft.getLevel(t);this.Enemy.getComponent(mt).show(e,a),this.show_battle(e,a,!1)}show_map(){this.Map.visible=!0,this.Battle.visible=!1,this.update_map()}show_battle(t,e,a){this.Map.visible=!1,this.Battle.visible=!0,this.battle.init(t,e,a),this.battle.start()}update_player(){var t,e,a;let i=Z.data.player,s=S.table.Tbrole.get(i.id),o=G(i.level),l=S.table.Tbrebirth.get(Z.data.game.rebirth),h=Ft.getAddition(),n=Ft.getAttack(s,o,l,h),r=Ft.getDefence(s,o,l,h),d=Ft.getHealth(s,o,l,h),c=Ft.getPower(n,r,d),u=i.exp,g=s.expNeed*o.need,f=Ft.getRoleName(s);this.label_1.text="种族:".toStr()+`${f}\n${"战力:".toStr()}${O(c)}\n${"等级:".toStr()}${i.level}(${z(u/g)})\n${"转生:".toStr()}${Z.data.game.rebirth}\n<font color='#6FD368'>${"灵气:".toStr()}${O(null!=(t=i.quality.ling)?t:0)}</font>\n<font color='#D7AC5E'>${"仙气:".toStr()}${O(null!=(e=i.quality.xian)?e:0)}</font>\n<font color='#C26060'>${"神韵:".toStr()}${O(null!=(a=i.quality.shen)?a:0)}</font>`,this.label_2.text=`${"攻击:".toStr()}<font color='#DCDCDC'>${O(n)}</font>\t${"防御:".toStr()}<font color='#DCDCDC'>${O(r)}</font>\n${"血量:".toStr()}<font color='#DCDCDC'>${O(d)}</font>`,this.list_shuxing.dataSource=Object.keys(i.relation).map((t=>`${N[t].toStr()}:<font color='#AFAFAF'>${O(i.relation[t])}</font>`)),this.player0.getComponent(mt).show(i.id,i.level,c),this.Player.getComponent(mt).show(i.id,i.level),this.btn_zidong.active=Z.data.game.rebirth>0,this.btn_cuilian.tip.text="需要等级>".toStr()+Ot.level,this.btn_zhuansheng.tip.text="需要等级>".toStr()+l.need,this.btn_jinhua.tip.text="需要等级>".toStr()+E[Math.min(E.length-1,s.rare)],j.log(B.zhandouli.toStr().replace("*",O(c)),!1)}update_skill(){var t,e;let a=Z.data.player,i=S.table.Tbrole.get(a.id);null==(t=this.list_guyou.renderHandler)||t.clear(),null==(e=this.list_xuexi.renderHandler)||e.clear(),this.list_guyou.array=i.skills,this.list_guyou.renderHandler=Laya.Handler.create(this,((t,e)=>{t.getComponent(ot).show(i.skills[e])}),null,!1);let s=a.skills.concat(new Array(this.getSkillMax()-a.skills.length).fill(""));this.list_xuexi.array=s,this.list_xuexi.renderHandler=Laya.Handler.create(this,((t,e)=>{t.getComponent(ot).show(s[e],!0)}),null,!1)}update_map(){let t=Z.data.player.curScene;if(t>S.table.Tbmap_level.getDataList().length)return;this.label_titile.text="第*层".toStr().replace("*",P(t));let e=S.table.Tbmap_level.get(t),a=!0,i=Z.data.player.scenes[t];i.count>=3?(this.btn_sousuo.tip.text="",this.btn_shenru.active=!0,this.btn_boss.visible=!i.pass,a=i.pass>0):(this.btn_sousuo.tip.text="击败怪物:".toStr()+`${i.count}/3`,this.btn_shenru.active=!1,this.btn_boss.visible=!1),this.btn_shenru.visible=a,1==t?this.btn_fanhui.active=!1:(this.btn_fanhui.active=!0,t>=105&&(this.btn_shenru.active=!1));var s=Ft.getMonsterListByScene(e);this.monster0.getComponent(mt).init(e.attackRate,s[0],Ft.getLevel(e)),this.monster1.getComponent(mt).init(e.attackRate,s[1],Ft.getLevel(e)),this.monster2.getComponent(mt).init(e.attackRate,s[2],Ft.getLevel(e));let o=B.qianjin.toStr();s.forEach(((t,e)=>{o=o.replace(`{${e}}`,Ft.getRoleName(S.table.Tbrole.get(t)))})),j.log(o,!1)}deal_battle_result(){if(this.battle.escape)console.log("player escapes the battle!"),j.log(B.zhandou.taopao);else if(this.battle.draw){if(console.log("the battle is a draw!"),F.tip("大战100回合，精疲力尽了！"),Z.data.setting.auto)return void this.auto_fight()}else if(this.battle.player.isAlive()){if(j.log(B.zhandou.siwang1.toStr().replace("*",Ft.getRoleName(this.battle.enemy.view.data)),!1),this.battle.victory(),Z.data.setting.auto)return void this.auto_fight();Laya.SoundManager.playSound(S.sounds.get("win")),Z.saveGame()}else j.log(B.zhandou.siwang2.toStr().replace("*",Ft.getRoleName(this.battle.enemy.view.data)),!1),this.player_dead();j.log(B.zhandou.jieshu),Laya.SoundManager.playMusic(S.sounds.get("bgm")),this.show_map()}player_dead(){console.log("广告时刻"),this.curPlayerData=JSON.parse(JSON.stringify(Z.data.player)),Z.data.player=Z.reset(),Laya.SoundManager.playSound(S.sounds.get("die")),Z.data.setting.auto=!1,this.update_auto(),Z.saveGame();let t=F.show("<font color='^'>你死了</font>等级将降为1级".toStr().replace("^",R.xinximoban.shanghai),(()=>{this.fuhuo_tip.ok.active=!1,U()?Y(1):(this.curPlayerData.revive--,this.fuhuo_success())}),(()=>{this.fuhuo_fail()}),!0,!1);this.fuhuo_tip=t,t.ok.title.text="复活".toStr(),U()?t.ok.tip.text="看广告".toStr():this.curPlayerData.revive<=0?t.ok.active=!1:(t.ok.active=!0,t.ok.tip.text="剩余次数:".toStr()+`${this.curPlayerData.revive}`)}fuhuo_success(){Z.data.player=this.curPlayerData,this.update_map(),F.tip("<font color='^'>你复活了</font>".toStr().replace("^",R.xinximoban.huixue),!1),Laya.SoundManager.playSound(S.sounds.get("upgrade")),Z.saveGame(),this.fuhuo_tip&&this.fuhuo_tip.close((()=>{this.fuhuo_tip.destroy(),this.fuhuo_tip=null}))}fuhuo_load(){this.fuhuo_tip&&(this.fuhuo_tip.ok.active=!0)}fuhuo_fail(){F.tip("<font color='^'>你死了</font>,等级降为1级".toStr().replace("^",R.xinximoban.shanghai),!1),this.show_map(),this.update_player(),this.update_skill(),Z.saveGame(),this.fuhuo_tip&&this.fuhuo_tip.close((()=>{this.fuhuo_tip.destroy(),this.fuhuo_tip=null}))}static getRoleName(t){let e=R.pinzhi[t.qualityType],a=R.name[t.rare];return`<font color=${e}>${this.getQualityStr(t.qualityType).toStr()}</font><font color=${R.name.dian}>·</font><font color=${a}>${t.name.toStr()}</font>`}static getQualityStr(t){return"ling"===t?"灵":"xian"===t?"仙":"shen"==t?"神":"凡"}getSkillMax(){let t=Z.data.player,e=S.table.Tbrole.get(t.id),a=1;return e.skills.concat(t.skills).forEach((t=>{let e=S.table.Tbskill.get(t);13===e.type&&(a+=e.values.get("1"))})),a+=Z.data.game.rewards.skill,a}static getLevelMax(){return 99+10*Z.data.game.rewards.level}static addExp(t){let e=Z.data.player,a=H(e.exp+t);for(;;){let t=G(e.level),i=S.table.Tbrole.get(e.id);const s=t.need*i.expNeed;if(!(a>=s))break;a-=s,this.addLevel()}e.exp=a}static addLevel(){let t=Z.data.player;t.level>=this.getLevelMax()?F.tip("已达到最高等级！"):(Laya.SoundManager.playSound(S.sounds.get("upgrade")),t.level++,F.tip("等级+1"),j.log(B.shengji.toStr().replace("*",t.level.toString()),!1))}static addValue(t){var e,a;let i=Z.data.player;var s=H(t.quality*T);i.quality[t.qualityType]=(null!=(e=i.quality[t.qualityType])?e:0)+s;var o=i.relation,l=t.relations,h=Object.keys(o),n=t.race*t.remain*T,r="";for(let t=0;t<h.length;t++){const e=h[t];var d=H((null!=(a=l[e])?a:0)*n);if(o[e]+=d,d>0){r+=`${N[e].toStr()}:+${d}，\t\t`}}r.length>0&&(r=r.substring(0,r.lastIndexOf("，\t\t"))),F.tip(r,!1)}static unlockRole(t){let e=S.table.Tbrole.get(t);F.tip("解锁图鉴：".toStr()+`${this.getRoleName(e)}`,!1),Z.data.game.roles[t]=1}learn(t){if(Math.random()>.2)return;let e=this.getSkillMax(),a=Z.data.player,i=S.table.Tbrole.get(a.id).skills.concat(a.skills);if(a.skills.length>=e)return void F.tip("技能已满！");const s=new Set(i),o=[...t.skills.filter((t=>!s.has(t)))].sort((()=>.5-Math.random())),l=o.slice(0,Math.min(1,o.length));if(l.length>0){const e=l[0],i=S.table.Tbskill.get(e);i&&(a.skills.push(e),F.tip(B.tunshi.toStr().replace("*",Ft.getRoleName(t)).replace("&",i.name.toStr()).replace("^",R.xinximoban.skill),!1),this.update_skill())}}static getAddition(t=Z.data.game.roles){let e={attack:0,defence:0,health:0};return S.table.Tbrole.getDataList().forEach((a=>{t[a.id]&&(e.attack+=a.attackAdd,e.defence+=a.defenceAdd,e.health+=a.healthAdd)})),e}static getAttack(t,e,a,i){let s;return s=e.attack*t.attackRate*(1+a.attack),s+=i.attack,H(s*C)}static getDefence(t,e,a,i){let s;return s=e.defence*t.defenceRate*(1+a.defence),s+=i.defence,H(s*C)}static getHealth(t,e,a,i){let s;return s=e.health*t.healthRate*(1+a.health),s+=i.health,H(s*C)}static getPower(t,e,a){return H((t+e)*M+a)}static isBoss(t){return 0===t.id.indexOf("b")}static getBoss(t){return t.id>100?"b"+(t.id-100):this.getMonsterByScene(t)}static getMonsterByScene(t){var e,a,i=t.monsters,s=0;for(var o in i)s+=null!=(e=i[o])?e:0;let l=H(Math.random()*s),h=0;for(let t in i)if(h+=null!=(a=i[t])?a:0,l<h)return t;return null}static getMonsterListByScene(t){var e=t.monsters;const a=Object.keys(e).map((t=>({key:t,value:e[t]})));if(0===a.length)return[];for(let t=a.length-1;t>0;t--){const e=H(Math.random()*(t+1));[a[t],a[e]]=[a[e],a[t]]}const i=a.reduce(((t,e)=>{var a;return t+(null!=(a=e.value)?a:0)}),0);if(i<=0)return[];const s=new Set;let o=0;for(;s.size<3&&o<1e3;){o++;let t=Math.random()*i,e=0;for(const{key:i,value:o}of a)if(e+=null!=o?o:0,t<e){s.add(i);break}}return o>=1e3&&console.warn("Exceeded max attempts to select monsters. Ensure probabilities are set correctly."),Array.from(s)}static getLevel(t){return Math.round(Math.random()*(t.levelMax-t.levelMin))+t.levelMin}};Ft=a([qt("gFM8IGO1T4aKS_u8PMeg9g")],Ft);var Gt=[{type:"skill",rate:.35},{type:"level",rate:.35},{type:"role",rate:.1},{type:"refresh",rate:.2}];function It(){const t=Math.random();let e=0;for(const a of Gt)if(e+=a.rate,t<e)return a.type;return"skill"}var Vt=[{type:1,rate:.5},{type:2,rate:.2},{type:3,rate:.15},{type:4,rate:.07},{type:5,rate:.05},{type:6,rate:.02},{type:7,rate:.01}];function Jt(){const t=Math.random();let e=0;for(const a of Vt)if(e+=a.rate,t<e)return a.type;return 1}var Kt=[{type:1,rate:.8},{type:2,rate:.15},{type:3,rate:.05}];function Xt(){const t=Math.random();let e=0;for(const a of Kt)if(e+=a.rate,t<e)return a.type;return 1}var Ut=[{rarity:1,rate:.5},{rarity:2,rate:.3},{rarity:3,rate:.15},{rarity:4,rate:.04},{rarity:5,rate:.01}];function Yt(){const t=Math.random();let e=0;for(const a of Ut)if(e+=a.rate,t<e)return a.rarity;return Ut[Ut.length-1].rarity}var Qt=[{rare:1,rate:.3},{rare:2,rate:.18},{rare:3,rate:.15},{rare:4,rate:.12},{rare:5,rate:.1},{rare:6,rate:.08},{rare:7,rate:.04},{rare:8,rate:.02},{rare:9,rate:.01}];function Wt(){const t=Math.random();let e=0;for(const a of Qt)if(e+=a.rate,t<e)return a.rare;return Qt[Qt.length-1].rare}function Zt(t){const e=function(t){const e=[];for(let a=1;a<=9;a++){let i=0,s=0;if(1===a?(i=1,s=50):2===a?(i=1,s=60):3===a?(i=10,s=20):4===a?(i=20,s=35):5===a?(i=35,s=50):6===a?(i=50,s=65):7===a?(i=65,s=80):8===a?(i=80,s=95):9===a&&(i=95,s=110),t<i){e.push(0);continue}let o=1;t<s&&(o=(t-i)/(s-i));let l=1;1===a&&t>80&&(l=Math.max(0,1-(t-80)/40)),2===a&&t>100&&(l=Math.max(0,1-(t-100)/40));const h=Math.max(0,10-a),n=Math.pow(t/100,.8*a);e.push((h*(1-n)+n*a*2)*o*l)}return e}(t),a=e.reduce(((t,e)=>t+e),0);let i=Math.random()*a;for(let t=0;t<e.length;t++)if(i-=e[t],i<=0)return t+1;return 9}function te(t){if(t<1)throw new Error("Level must be at least 1");const e=[],a=[...S.table.Tbrole.getDataList()];for(let i=0;i<3&&0!==a.length;i++){const i=Zt(t),s=a.filter((t=>t.rare===i));if(0===s.length)continue;const o=s[Math.floor(Math.random()*s.length)];e.push(o.id);const l=a.findIndex((t=>t.id===o.id));a.splice(l,1)}return e}var{regClass:ee}=Laya,ae=class extends Ft{constructor(){super(...arguments),this.labels=[]}onAwake(){Ft.instance=this,this.battle=new jt,this.list_guyou.scrollBar.autoHide=!0,this.list_xuexi.scrollBar.autoHide=!0,this.show_map(),this.update_player(),this.update_skill(),this.btn_tujian.onClick=()=>{this.Tujian.getComponent(ht).show()},this.btn_zhuansheng.onClick=()=>{Laya.Scene.open("Login.ls")},this.List.array=j.get(),j.instance.callback=()=>{this.List.refresh(),this.List.scrollTo(this.List.array.length-1)},this.List.scrollBar.autoHide=!0,this.Reward=this.getChildByName("Reward"),this.Reward.ok.onClick=()=>{ae.data.refresh--,this.show_rewards()},this.Reward.no.onClick=()=>{this.Des.visible=!this.Des.visible,this.Reward.no.title.text=this.Des.visible?"关闭".toStr():"详情".toStr()},this.Des=this.Reward.getChildByName("Des");let t=this.Des.getChildByName("VBox");for(let e=1;e<4;e++){let a=t.getChildByName(`Label${e}`);this.labels.push(a)}this.Reward.getChildByName("back").onClick=()=>{this.Reward.close(),this.battle_end()}}show_first(){this.Reward.open(),this.Reward.ok.visible=!1,this.Reward.no.visible=!1,te(1).forEach(((t,e)=>{let a=this.Reward.getChildByName(`${e}`),i=S.table.Tbrole.get(t),s=Ft.getRoleName(i);a.title.text=s.replace("·","\n·\n"),a.onClick=()=>{this.Reward.close(),ae.data.id=i.id,ae.data.roles[i.id]=1,F.tip("获得".toStr()+`:${s}`,!1),this.update_player(),this.update_skill(),this.battle_end()}}))}show_rewards(){this.Reward.open(),this.Reward.ok.visible=!0,this.Reward.no.visible=!0,this.Reward.ok.tip.text=ae.data.refresh>0?"剩余次数:".toStr()+`${ae.data.refresh}`:"",this.Reward.ok.active=ae.data.refresh>0,this.Reward.no.title.text=this.Des.visible?"关闭".toStr():"详情".toStr(),function(t){const e=[],a=new Set(t.skills.concat(S.table.Tbrole.get(t.id).skills)),i=new Set(Object.keys(t.roles));for(;e.length<3;){const t=It();if("skill"===t){const t=S.table.Tbskill.getDataList().filter((t=>!a.has(t.id)));if(0===t.length)continue;const i=Yt(),s=t.filter((t=>t.rarity===i));if(0===s.length)continue;const o=Math.floor(Math.random()*s.length);e.push({type:"skill",value:s[o]})}else if("role"===t){const t=S.table.Tbrole.getDataList().filter((t=>!i.has(t.id)));if(0===t.length)continue;const a=Wt(),s=t.filter((t=>t.rare===a));if(0===s.length)continue;const o=Math.floor(Math.random()*s.length);e.push({type:"role",value:s[o]})}else"refresh"===t?e.push({type:"refresh",value:Jt()}):e.push({type:"level",value:Xt()})}return e}(ae.data).forEach(((t,e)=>{let a=this.Reward.getChildByName(`${e}`);if(this.labels[e].text="","skill"===t.type){let i=t.value;a.title.text="技能".toStr()+"\n\n"+i.name.toStr(),a.onClick=()=>{this.Reward.close(),ae.data.skills.push(i.id),F.tip("习得：".toStr()+`${i.name.toStr()}`,!1),this.update_skill(),this.battle_end()},this.labels[e].text=`<font color='#ffe900' size=40>${i.name.toStr()}</font>：${i.description.toStr()}`}else if("role"===t.type){let e=Ft.getRoleName(t.value);a.title.text=e.replace("·","\n·\n"),a.onClick=()=>{this.Reward.close(),ae.data.id=t.value.id,ae.data.roles[t.value.id]=1,F.tip("获得".toStr()+`:${e}`,!1),this.update_player(),this.update_skill(),this.battle_end()}}else"level"===t.type?(a.title.text="等级".toStr()+` +${t.value}`,a.onClick=()=>{this.Reward.close(),ae.data.level+=t.value,F.tip(a.title.text,!1),this.update_player(),this.battle_end()}):"refresh"===t.type&&(a.title.text="刷新".toStr()+` +${t.value}`,a.onClick=()=>{this.Reward.close(),ae.data.refresh+=t.value,F.tip(a.title.text,!1),this.battle_end()})}))}update_player(){let t=ae.data,e=S.table.Tbrole.get(t.id),a=G(t.level),i=S.table.Tbrebirth.get(0),s=Ft.getAddition(t.roles),o=Ft.getAttack(e,a,i,s),l=Ft.getDefence(e,a,i,s),h=Ft.getHealth(e,a,i,s),n=Ft.getPower(o,l,h),r=Ft.getRoleName(e);this.label_1.text="种族:".toStr()+`${r}\n${"战力:".toStr()}${O(n)}\n${"等级:".toStr()}${t.level}\n${"攻击:".toStr()}<font color='#DCDCDC'>${O(o)}</font>\n${"防御:".toStr()}<font color='#DCDCDC'>${O(l)}</font>\n${"血量:".toStr()}<font color='#DCDCDC'>${O(h)}</font>`,this.player0.getComponent(mt).show(t.id,t.level,n),this.Player.getComponent(mt).show(t.id,t.level),j.log(B.zhandouli.toStr().replace("*",O(n)),!1)}update_skill(){var t,e;let a=ae.data,i=S.table.Tbrole.get(a.id);null==(t=this.list_guyou.renderHandler)||t.clear(),null==(e=this.list_xuexi.renderHandler)||e.clear(),this.list_guyou.array=i.skills,this.list_guyou.renderHandler=Laya.Handler.create(this,((t,e)=>{t.getComponent(ot).show(i.skills[e])}),null,!1);let s=a.skills;this.list_xuexi.array=s,this.list_xuexi.renderHandler=Laya.Handler.create(this,((t,e)=>{t.getComponent(ot).show(s[e])}),null,!1)}getLevelScale(t){return 1+.03*Math.pow(Math.max(0,t-1),1.2)}update_map(){let t=++ae.data.curScene;const e=this.getLevelScale(t);this.label_titile.text="第*层".toStr().replace("*",P(t)),j.log(B.shenru.toStr().replace("*",P(t)),!1);var a=te(t);this.monster0.getComponent(mt).init(e,a[0],t),this.monster1.getComponent(mt).init(e,a[1],t),this.monster2.getComponent(mt).init(e,a[2],t);let i=B.qianjin.toStr();a.forEach(((t,e)=>{i=i.replace(`{${e}}`,Ft.getRoleName(S.table.Tbrole.get(t)))})),j.log(i,!1),ae.data.isNew&&(ae.data.isNew=!1,ae.data.curScene=0,this.show_first())}show_battle(t,e,a){this.Map.visible=!1,this.Battle.visible=!0,this.init_battle(t,e,!0),this.battle.start()}init_battle(t,e,a){let i=ae.data,s=S.table.Tbrole.get(i.id),o=G(i.level),l=S.table.Tbrebirth.get(0),h=Ft.getAddition(i.roles),n=Ft.getAttack(s,o,l,h),r=Ft.getDefence(s,o,l,h),d=Ft.getHealth(s,o,l,h);this.battle.player.init(n,r,d,s.skills.concat(i.skills));const c=this.getLevelScale(i.curScene);s=S.table.Tbrole.get(t),o=G(e),n=H(o.attack*s.attackRate*c),r=H(o.defence*s.defenceRate*c),d=H(o.health*s.healthRate*c),this.Enemy.getComponent(mt).show_skin(a),this.battle.bossHp.bg.visible=a,this.battle.enemy.init(n,r,d,s.skills,a)}deal_battle_result(){if(this.battle.draw)console.log("the battle is a draw!"),F.tip("大战100回合，精疲力尽了！"),ae.data.curScene--,this.battle_end();else if(this.battle.player.isAlive())Laya.SoundManager.playSound(S.sounds.get("win")),this.show_rewards();else{this.curEndlessData=JSON.parse(JSON.stringify(ae.data));let e=F.show("你失败了！".toStr(),(()=>{this.fuhuo_tip.ok.active=!1,this.curEndlessData.revive<=0?U()&&Y(1):(this.curEndlessData.revive--,this.fuhuo_success())}),(()=>{this.fuhuo_fail()}),!0,!1);this.fuhuo_tip=e,e.ok.title.text="复活".toStr(),this.curEndlessData.revive<=0?U()?e.ok.title.text="观看广告".toStr():e.ok.active=!1:(e.ok.active=!0,e.ok.tip.text="剩余次数:".toStr()+`${this.curEndlessData.revive}`),t="endless",Laya.LocalStorage.removeItem(t),console.log("Save deleted successfully!"),Laya.SoundManager.playSound(S.sounds.get("die"))}var t;Laya.SoundManager.playMusic(S.sounds.get("bgm"))}fuhuo_success(){ae.data=this.curEndlessData,F.tip("<font color='^'>你复活了</font>".toStr().replace("^",R.xinximoban.huixue),!1),Laya.SoundManager.playSound(S.sounds.get("upgrade")),ae.data.curScene--,this.battle_end(),this.fuhuo_tip&&this.fuhuo_tip.close((()=>{this.fuhuo_tip.destroy(),this.fuhuo_tip=null}))}fuhuo_fail(){this.fuhuo_tip&&this.fuhuo_tip.close((()=>{this.fuhuo_tip.destroy(),this.fuhuo_tip=null})),Laya.Scene.open("Login.ls")}battle_end(){j.log(B.zhandou.jieshu),this.show_map(),function(t,e){try{const a=JSON.stringify(e);Laya.LocalStorage.setItem(t,a),j.log("存档保存成功!")}catch(t){console.error("Failed to save game:",t)}}("endless",ae.data)}};ae=a([ee("WWvzZBhOS9ijx1BtSV18UA")],ae);var{regClass:ie}=Laya,se=class extends Laya.Script{onAwake(){this.owner.text=this.owner.text.toStr()}};se=a([ie("lyjYBkxSTa2FXWv6tWLNKQ")],se);var oe=class extends Laya.Sprite{},{regClass:le}=Laya,he=class extends oe{constructor(){super(...arguments),this.isPressed=!1,this.color="#FF2929"}onAwake(){this.image=this.getChildByName("Image"),this.title=this.image.getChildByName("Title"),this.tip=this.getChildByName("Tip"),this.image.on(Laya.Event.MOUSE_DOWN,this,this.onPress),this.image.on(Laya.Event.MOUSE_UP,this,this.onRelease),this.image.on(Laya.Event.MOUSE_OUT,this,this.onRelease),this.originalColor=this.image.color}onDestroy(){this.image.off(Laya.Event.MOUSE_DOWN,this,this.onPress),this.image.off(Laya.Event.MOUSE_UP,this,this.onRelease),this.image.off(Laya.Event.MOUSE_OUT,this,this.onRelease)}onEnable(){this.image.disabled=!1}onDisable(){this.image.disabled=!0}onPress(){this.isPressed=!0,this.image.color=this.color,Laya.Tween.to(this.image,{scaleX:.9,scaleY:.9},100,Laya.Ease.quadIn),Laya.SoundManager.playSound(S.sounds.get("ui_anniu"))}onRelease(){if(this.image.color=this.originalColor,this.isPressed&&(this.isPressed=!1,this.image.hitTestPoint(Laya.stage.mouseX,Laya.stage.mouseY)))return Laya.SoundManager.playSound(S.sounds.get("ui_anniu2")),void Laya.Tween.to(this.image,{scaleX:1,scaleY:1},100,Laya.Ease.quadOut,Laya.Handler.create(this,(()=>{this.onClick&&this.onClick()})));Laya.Tween.to(this.image,{scaleX:1,scaleY:1},100)}};he=a([le("mk3vMNXVSGieSd9t6-NHxg")],he);var ne=class extends Laya.Box{},{regClass:re}=Laya,de=class extends ne{open(){this.visible=!0,this.scale(0,0),this.alpha=0,Laya.Tween.to(this,{scaleX:1,scaleY:1,alpha:1},300,Laya.Ease.backOut)}close(t){Laya.Tween.to(this,{scaleX:0,scaleY:0,alpha:0},300,Laya.Ease.backOut,Laya.Handler.create(this,(()=>{t?t():this.visible=!1})))}};de=a([re("NpR6WP_JT4u_-iaEnCk4lA")],de),window.$_main_=function(){return i(this,null,(function*(){let t=Laya.stage.addChild(new Laya.Label);A.init(),yield S.load_config(),t.dataSource={text:D[Math.floor(Math.random()*D.length)].toStr(),x:60,width:Laya.stage.width-120,height:Laya.stage.height,wordWrap:!0,align:"center",valign:"middle",fontSize:30,color:"#ffffff"},yield S.load_sound(),yield S.load_prefab(),j.log("----------开局一只史莱姆----------"),Z.init()}))}})();